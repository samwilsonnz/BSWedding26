<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Samuel & Beatrice's Wedding | March 14th, 2026 | Christchurch, New Zealand</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#1e3a5f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="SB Wedding">
    <link rel="apple-touch-icon" href="/icons/icon.svg">

    <!-- Meta Tags for Social Sharing -->
    <meta name="description" content="Join us as we celebrate the wedding of Samuel Wilson and Beatrice Billcliff on March 14th, 2026 in Christchurch, New Zealand.">
    <meta property="og:title" content="Samuel & Beatrice's Wedding">
    <meta property="og:description" content="Celebrating our love on March 14th, 2026 in Christchurch, New Zealand">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bswedding26.com">
    <meta property="og:image" content="https://bswedding26.com/Photos/Bridge%20Photo.PNG">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Samuel & Beatrice's Wedding">
    <meta name="twitter:description" content="March 14th, 2026 | Christchurch, New Zealand">
    <meta name="twitter:image" content="https://bswedding26.com/Photos/Bridge%20Photo.PNG">

    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Great+Vibes&display=swap" rel="stylesheet">
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/qr-scanner@1.4.2/qr-scanner.umd.min.js"></script>
    <script src="enhancements.js" defer></script>
    <style>
        :root {
            /* Navy Theme - Primary Palette */
            --navy: #1a365d;
            --navy-dark: #0f2744;
            --navy-light: #2d4a6f;
            --light-navy: #2c5282;
            --botanical-blue: #4a7c9e;

            /* Accent Colors */
            --gold: #d4af37;
            --gold-light: #e8c967;
            --gold-dark: #b8942e;

            /* Backgrounds */
            --beige: #f5f5dc;
            --cream: #faf8f5;
            --white: #ffffff;

            /* Semantic Colors */
            --success: #22c55e;
            --success-light: #dcfce7;
            --warning: #f59e0b;
            --warning-light: #fef3c7;
            --error: #ef4444;
            --error-light: #fee2e2;

            /* Glassmorphism */
            --glass-bg: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.3);
            --glass-blur: 12px;

            /* Shadows - Modern */
            --shadow: rgba(0, 0, 0, 0.06);
            --shadow-lg: rgba(0, 0, 0, 0.1);
            --shadow-xl: rgba(0, 0, 0, 0.15);
            --shadow-glow: 0 8px 32px rgba(26, 54, 93, 0.12);

            /* Border Radius - Rounded Modern */
            --radius-sm: 12px;
            --radius-md: 16px;
            --radius-lg: 20px;
            --radius-xl: 24px;
            --radius-full: 9999px;

            /* Transitions - Spring-like */
            --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-spring: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: var(--navy);
            line-height: 1.6;
            overflow-x: hidden;
            font-weight: 500;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: linear-gradient(
                180deg,
                #ffffff 0%,
                #faf8f5 15%,
                #ffffff 30%,
                #f8f6f3 45%,
                #ffffff 60%,
                #faf8f5 75%,
                #ffffff 90%,
                #f8f6f3 100%
            );
            background-attachment: fixed;
        }

        /* Script Font for Elegant Text */
        .script-font {
            font-family: 'Great Vibes', cursive;
        }

        /* Modern weight utilities */
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .font-extrabold { font-weight: 800; }

        /* Login Screen Styles */
        .login-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
            text-align: center;
            background: linear-gradient(135deg, var(--cream) 0%, var(--white) 30%, var(--beige) 70%, var(--cream) 100%);
        }

        .login-container {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            padding: 2.5rem;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-glow);
            border: 1px solid var(--glass-border);
            max-width: 420px;
            width: 100%;
        }

        .login-container h1 {
            color: var(--navy);
            margin-bottom: 1rem;
            font-size: 2.5rem;
        }

        .login-container p {
            color: var(--light-navy);
            margin-bottom: 2rem;
            font-size: 1.1rem;
        }

        .login-options {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .login-option {
            flex: 1;
            background: var(--beige);
            border: 2px solid var(--navy);
            border-radius: 15px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .login-option:hover, .login-option.active {
            background: var(--navy);
            color: var(--white);
            transform: translateY(-3px);
        }

        .login-option i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .guest-code-form {
            display: none;
        }

        .guest-code-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--navy);
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--beige);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.2);
        }

        .form-group input:focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 95, 0.3);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Multi-Step Auth Flow Styles */
        .auth-steps {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--beige);
        }

        .auth-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .auth-step.active {
            opacity: 1;
        }

        .auth-step.completed {
            opacity: 0.8;
        }

        .auth-step.completed .step-number {
            background: var(--success);
            border-color: var(--success);
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--beige);
            border: 2px solid var(--navy);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: var(--navy);
            transition: all 0.3s ease;
        }

        .auth-step.active .step-number {
            background: var(--navy);
            color: white;
        }

        .step-label {
            font-size: 0.7rem;
            color: var(--navy);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .auth-step-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .auth-step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .back-btn {
            background: transparent;
            border: 2px solid var(--beige);
            color: var(--light-navy);
            padding: 0.75rem 1rem;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
            width: 100%;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            border-color: var(--navy);
            color: var(--navy);
        }

        .auth-error {
            background: var(--error-light);
            color: var(--error);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin: 1rem 0;
            text-align: center;
        }

        /* RSVP Options in Auth Flow */
        .rsvp-options {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.5rem;
        }

        .rsvp-option {
            cursor: pointer;
        }

        .rsvp-option input {
            display: none;
        }

        .rsvp-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            border: 2px solid var(--beige);
            border-radius: 10px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .rsvp-label i {
            font-size: 1.2rem;
        }

        .rsvp-label.yes { color: var(--navy); }
        .rsvp-label.no { color: var(--light-navy); }
        .rsvp-label.maybe { color: var(--botanical-blue); }

        .rsvp-option:hover .rsvp-label {
            border-color: var(--navy);
            transform: translateX(5px);
        }

        .rsvp-option input:checked + .rsvp-label.yes {
            background: var(--success-light);
            border-color: var(--success);
            color: var(--success);
        }

        .rsvp-option input:checked + .rsvp-label.no {
            background: var(--error-light);
            border-color: var(--error);
            color: var(--error);
        }

        .rsvp-option input:checked + .rsvp-label.maybe {
            background: var(--warning-light);
            border-color: var(--warning);
            color: #92400e;
        }

        /* Family RSVP Section */
        .family-rsvp-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: var(--cream);
            border-radius: 8px;
            margin-bottom: 1rem;
            color: var(--navy);
            font-weight: 600;
        }

        .family-members-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .family-member-item {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            padding: 1rem;
            background: white;
            border: 2px solid var(--beige);
            border-radius: 8px;
            font-size: 0.95rem;
            gap: 1rem;
        }

        .family-member-item.already-rsvped {
            opacity: 0.6;
            align-items: center;
        }

        .family-member-name {
            flex: 1;
            min-width: 0;
        }

        .family-member-name span {
            font-weight: 600;
            color: var(--navy);
        }

        .family-member-name .rsvp-status {
            display: block;
            color: var(--light-navy);
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .family-member-inputs {
            flex: 1;
            min-width: 140px;
        }

        .family-member-item select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--beige);
            border-radius: 6px;
            font-size: 0.85rem;
        }

        .rsvp-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            background: var(--cream);
            color: var(--navy);
        }

        /* Already RSVPed Message */
        .already-rsvped {
            text-align: center;
            padding: 2rem;
        }

        .already-rsvped i {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 1rem;
        }

        .already-rsvped h3 {
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .already-rsvped p {
            color: var(--light-navy);
            margin-bottom: 0;
        }

        /* QR Scanner Styles */
        .qr-scanner {
            display: none;
        }

        .qr-scanner.active {
            display: block;
        }

        .scanner-container {
            position: relative;
            margin: 1rem 0;
            border-radius: 15px;
            overflow: hidden;
        }

        #qr-video {
            width: 100%;
            max-width: 400px;
            border-radius: 15px;
        }

        .scanner-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border: 3px solid var(--gold);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
        }

        .scanner-overlay::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border: 3px solid transparent;
            border-top-color: var(--gold);
            border-radius: 15px;
            animation: scan 2s linear infinite;
        }

        @keyframes scan {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .scanner-instructions {
            margin-top: 1rem;
            color: var(--light-navy);
            font-size: 0.9rem;
        }

        .close-scanner {
            margin-top: 1rem;
            background: var(--error);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            cursor: pointer;
        }

        /* Navigation progress indicator */
        .nav-progress {
            position: fixed;
            top: 0;
            left: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--navy), var(--gold));
            width: 0%;
            z-index: 1002;
            transition: width 0.1s ease;
        }

        /* Fixed Navigation Bar */
        .fixed-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 0.75rem 2rem;
            z-index: 1000;
            box-shadow: 0 1px 12px rgba(26, 54, 93, 0.04);
            border-bottom: 1px solid rgba(26, 54, 93, 0.08);
            transform: translateY(-100%);
            transition: transform 0.3s ease;
        }

        .fixed-nav.visible {
            transform: translateY(0);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo {
            color: var(--navy);
            font-size: 1.1rem;
            font-weight: 600;
            font-family: 'Great Vibes', cursive;
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--navy);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all var(--transition-fast);
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: rgba(26, 54, 93, 0.06);
            color: var(--navy);
        }

        .logout-nav-btn {
            background: transparent;
            color: var(--navy);
            border: 1px solid rgba(26, 54, 93, 0.15);
            padding: 0.4rem 1rem;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-normal);
            font-size: 0.85rem;
            font-weight: 500;
        }

        .logout-nav-btn:hover {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
        }

        /* Hero Section with Bridge Photo */
        .hero-section {
            position: relative;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            overflow: hidden;
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
        }

        .hero-background {
            position: absolute;
            top: -10%;
            left: -5%;
            width: 110%;
            height: 120%;
            background-image: url('Photos/Bridge Photo.PNG');
            background-size: cover;
            background-position: center;
            opacity: 0.6;
            z-index: 1;
            will-change: transform;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
            perspective: 1000px;
        }

        .hero-background::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(30, 58, 95, 0.4), rgba(30, 58, 95, 0.6));
        }

        /* Botanical Decorative Elements */
        .botanical-corner {
            position: absolute;
            z-index: 3;
            opacity: 0.4;
            pointer-events: none;
            will-change: transform;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
        }

        .botanical-top-left {
            top: 0;
            left: 0;
            width: 400px;
            height: 400px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><g fill="%234a7c9e"><path d="M10,10 Q40,15 50,30 L45,35 Q35,25 10,20 Z" opacity="0.7"/><path d="M20,25 Q45,30 55,45 L50,50 Q40,40 20,35 Z" opacity="0.6"/><path d="M30,40 Q50,45 60,60 L55,65 Q45,55 30,50 Z" opacity="0.7"/><path d="M15,15 Q30,40 25,60 L20,58 Q23,40 15,20 Z" opacity="0.6"/><path d="M35,30 Q50,55 45,75 L40,73 Q43,55 35,35 Z" opacity="0.7"/><path d="M55,45 Q70,70 65,90 L60,88 Q63,70 55,50 Z" opacity="0.6"/><ellipse cx="15" cy="25" rx="4" ry="8" transform="rotate(-30 15 25)" opacity="0.7"/><ellipse cx="25" cy="40" rx="5" ry="9" transform="rotate(-25 25 40)" opacity="0.6"/><ellipse cx="35" cy="55" rx="4" ry="7" transform="rotate(-35 35 55)" opacity="0.7"/><ellipse cx="45" cy="35" rx="5" ry="8" transform="rotate(-40 45 35)" opacity="0.6"/><ellipse cx="60" cy="50" rx="4" ry="9" transform="rotate(-20 60 50)" opacity="0.7"/><ellipse cx="70" cy="70" rx="5" ry="8" transform="rotate(-30 70 70)" opacity="0.6"/></g></svg>') no-repeat;
            background-size: contain;
        }

        .botanical-bottom-right {
            bottom: 0;
            right: 0;
            width: 450px;
            height: 450px;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 300 300"><g fill="%234a7c9e"><path d="M290,290 Q260,285 250,270 L255,265 Q265,275 290,280 Z" opacity="0.7"/><path d="M280,275 Q255,270 245,255 L250,250 Q260,260 280,265 Z" opacity="0.6"/><path d="M270,260 Q250,255 240,240 L245,235 Q255,245 270,250 Z" opacity="0.7"/><path d="M285,285 Q270,260 275,240 L280,242 Q277,260 285,280 Z" opacity="0.6"/><path d="M265,270 Q250,245 255,225 L260,227 Q257,245 265,265 Z" opacity="0.7"/><path d="M245,255 Q230,230 235,210 L240,212 Q237,230 245,250 Z" opacity="0.6"/><ellipse cx="285" cy="275" rx="4" ry="8" transform="rotate(30 285 275)" opacity="0.7"/><ellipse cx="275" cy="260" rx="5" ry="9" transform="rotate(25 275 260)" opacity="0.6"/><ellipse cx="265" cy="245" rx="4" ry="7" transform="rotate(35 265 245)" opacity="0.7"/><ellipse cx="255" cy="265" rx="5" ry="8" transform="rotate(40 255 265)" opacity="0.6"/><ellipse cx="240" cy="250" rx="4" ry="9" transform="rotate(20 240 250)" opacity="0.7"/><ellipse cx="230" cy="230" rx="5" ry="8" transform="rotate(30 230 230)" opacity="0.6"/></g></svg>') no-repeat;
            background-size: contain;
        }

        .hero-content {
            position: relative;
            z-index: 2;
            color: white;
            padding: 2rem;
            animation: fadeInUp 1.5s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            will-change: transform, opacity;
            transform: translate3d(0, 0, 0);
            backface-visibility: hidden;
        }

        .hero-content h1 {
            font-family: 'Great Vibes', cursive;
            font-size: clamp(2.5rem, 7vw, 4.5rem);
            margin-bottom: 0.5rem;
            text-shadow: 2px 4px 8px rgba(0,0,0,0.3);
            font-weight: 400;
            letter-spacing: -0.02em;
            animation: fadeIn 2s ease-out;
        }

        .hero-content .subtitle {
            font-family: 'Manrope', sans-serif;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            font-weight: 500;
            opacity: 0.9;
            margin-bottom: 1rem;
            opacity: 0.95;
            font-weight: 400;
            animation: fadeIn 2.5s ease-out;
        }

        /* Countdown Timer */
        .countdown-timer {
            margin: 2rem auto;
            padding: 1.25rem 2rem;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: inline-block;
            animation: fadeIn 3s ease-out;
        }

        .countdown-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
        }

        .countdown-item {
            text-align: center;
        }

        .countdown-number {
            font-size: clamp(1.5rem, 3vw, 2rem);
            font-weight: 600;
            font-family: 'Manrope', sans-serif;
            display: block;
            margin-bottom: 0.25rem;
        }

        .countdown-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.7;
        }

        /* RSVP Stats in Hero */
        .rsvp-stats-hero {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            margin: 1rem auto 1.5rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            font-size: 0.9rem;
            animation: fadeIn 3s ease-out 0.5s both;
        }

        .rsvp-stat-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .rsvp-stat-number {
            font-weight: 700;
            font-size: 1.1rem;
            font-family: 'Manrope', sans-serif;
        }

        .rsvp-stat-label {
            opacity: 0.85;
            font-size: 0.85rem;
        }

        .rsvp-stat-divider {
            opacity: 0.4;
        }

        .hero-content .date {
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            margin-bottom: 3rem;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 50px;
            display: inline-block;
        }

        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 2rem;
            animation: bounce 2s infinite;
            cursor: pointer;
            z-index: 2;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Section Styles */
        section {
            padding: 5rem 1.5rem 6rem;
            position: relative;
            overflow: hidden;
            background: transparent;
        }

        /* Soft wave dividers between sections */
        section::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 60px;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,60 C300,100 600,20 900,60 C1050,80 1150,90 1200,60 L1200,120 L0,120 Z' fill='%23ffffff'/%3E%3C/svg%3E") no-repeat bottom;
            background-size: cover;
            pointer-events: none;
            z-index: 1;
        }

        .section-container {
            max-width: 1100px;
            width: 100%;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .section-title {
            text-align: center;
            font-family: 'Great Vibes', cursive;
            font-size: clamp(2rem, 4vw, 2.75rem);
            font-weight: 400;
            color: var(--navy);
            margin-bottom: 3rem;
            position: relative;
            padding-bottom: 1rem;
        }

        .section-title::after {
            content: '';
            display: block;
            width: 40px;
            height: 2px;
            background: var(--gold);
            margin: 0.75rem auto 0;
            border-radius: 1px;
        }

        /* Section subtitle */
        .section-subtitle {
            font-family: 'Manrope', sans-serif;
            font-size: 1rem;
            font-weight: 400;
            color: var(--light-navy);
            opacity: 0.8;
            margin: -2rem auto 2.5rem;
            text-align: center;
            max-width: 500px;
        }

        /* Hide icons in section titles */
        .section-title i {
            display: none;
        }

        /* About Section */
        #about {
            background: transparent;
        }

        #about::after {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,60 C300,100 600,20 900,60 C1050,80 1150,90 1200,60 L1200,120 L0,120 Z' fill='%23f8f6f3'/%3E%3C/svg%3E");
        }

        .about-content-grid {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .about-text {
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        .about-text p {
            font-size: 1.1rem;
            line-height: 1.9;
            color: var(--navy);
            opacity: 0.85;
            text-align: center;
            max-width: 650px;
            margin: 0 auto 1.5rem;
        }

        .wedding-details-grid {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .detail-card {
            background: white;
            padding: 1.25rem 1.5rem;
            border-radius: var(--radius-md);
            border: 1px solid rgba(26, 54, 93, 0.08);
            box-shadow: 0 2px 12px rgba(26, 54, 93, 0.04);
            text-align: center;
            transition: all var(--transition-normal);
            min-width: 140px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .detail-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(26, 54, 93, 0.08);
            border-color: rgba(212, 175, 55, 0.3);
        }

        .detail-card i {
            font-size: 1.5rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }

        .detail-card h3 {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--light-navy);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .detail-card p {
            font-size: 1rem;
            font-weight: 500;
            color: var(--navy);
        }

        /* Registry Section */
        #registry {
            background: transparent;
            min-height: auto;
            padding: 4rem 1.5rem 5rem;
        }

        #registry::after {
            display: none;
        }

        .intro {
            text-align: center;
            margin-bottom: 2.5rem;
            background: transparent;
            padding: 0;
            border-radius: 0;
            box-shadow: none;
            border: none;
        }

        .intro p {
            font-size: 1.05rem;
            color: var(--light-navy);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.7;
            opacity: 0.85;
        }

        /* Statistics Section */
        /* Hide featured, almost-funded, and stats sections */
        .featured-section,
        .almost-funded-section,
        .featured-items,
        .almost-funded,
        .stats-section {
            display: none !important;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        .search-box input {
            width: 100%;
            padding: 1rem 1rem 1rem 3rem;
            border: 2px solid var(--beige);
            border-radius: 50px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .search-box input:focus {
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.15);
        }

        .search-box .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--light-navy);
        }

        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: center;
        }

        .filter-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: rgba(26, 54, 93, 0.06);
            color: var(--navy);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all var(--transition-spring);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .filter-btn:hover {
            background: rgba(26, 54, 93, 0.12);
            transform: translateY(-2px);
        }

        .filter-btn.active {
            background: var(--navy);
            color: var(--white);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.25);
        }

        .filter-btn:active {
            transform: scale(0.95);
        }

        /* Registry Grid */
        .registry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 4rem;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Flip Card Container */
        .registry-item {
            opacity: 0;
            transform: translateY(20px);
            animation: slideInUp 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .registry-item:nth-child(1) { animation-delay: 0.05s; }
        .registry-item:nth-child(2) { animation-delay: 0.1s; }
        .registry-item:nth-child(3) { animation-delay: 0.15s; }
        .registry-item:nth-child(4) { animation-delay: 0.2s; }
        .registry-item:nth-child(5) { animation-delay: 0.25s; }
        .registry-item:nth-child(6) { animation-delay: 0.3s; }

        @keyframes slideInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Single-sided card styles */
        .card-single {
            background: white;
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .registry-item:hover .card-single {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .card-image {
            position: relative;
            height: 200px;
            overflow: hidden;
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Dual image layout for items like Dyson */
        .dual-image-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2px;
            height: 100%;
            background: var(--cream);
        }

        .dual-image-container .dual-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 1rem;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--navy);
            flex: 1;
        }

        .card-price {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gold);
            margin-left: 0.5rem;
        }

        .card-description {
            font-size: 0.85rem;
            color: var(--light-navy);
            margin-bottom: 0.75rem;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-progress {
            margin-bottom: 0.75rem;
        }

        .card-progress-bar {
            height: 6px;
            background: var(--cream);
            border-radius: 3px;
            overflow: hidden;
        }

        .card-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .card-progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: var(--light-navy);
            margin-top: 0.25rem;
        }

        .card-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .card-actions * {
            list-style: none;
        }

        .card-actions::before,
        .card-actions *::before {
            display: none !important;
            content: none !important;
        }

        .quick-amounts-mini {
            display: flex;
            gap: 0.5rem;
        }

        .quick-amount-mini {
            flex: 1;
            padding: 0.5rem;
            background: var(--cream);
            border: 1px solid var(--gold-light);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--navy);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-amount-mini:hover, .quick-amount-mini.selected {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }

        .custom-amount-row {
            display: flex;
            gap: 0.5rem;
        }

        .custom-amount-row .amount-input-mini {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--gold-light);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
        }

        .custom-amount-row .contribute-btn-mini {
            padding: 0.5rem 1rem;
        }

        /* Donation input for Honeymoon Fund and custom amount */
        .donation-input-row {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            list-style: none;
        }

        .donation-input-row::before {
            display: none !important;
        }

        .donation-label {
            font-size: 1rem;
            font-weight: 600;
            color: var(--navy);
            flex-shrink: 0;
        }

        .donation-amount-input {
            flex: 1;
            min-width: 0;
            padding: 0.5rem 0.6rem;
            border: 2px solid var(--gold-light);
            border-radius: var(--radius-sm);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--navy);
            text-align: center;
        }

        .donation-amount-input:focus {
            outline: none;
            border-color: var(--gold);
        }

        .donate-btn {
            padding: 0.5rem 0.8rem;
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            border: none;
            border-radius: var(--radius-full);
            color: white;
            font-weight: 600;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .donate-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.3);
        }

        .contribute-btn-mini {
            width: 100%;
            padding: 0.6rem 1rem;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .contribute-btn-mini:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .bought-in-store-btn {
            width: 100%;
            padding: 0.5rem;
            background: transparent;
            border: 1px dashed var(--light-navy);
            border-radius: var(--radius-sm);
            color: var(--light-navy);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .bought-in-store-btn:hover {
            background: var(--cream);
            border-color: var(--navy);
            color: var(--navy);
        }

        .card-complete-section {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: var(--success-light);
            border-radius: var(--radius-sm);
        }

        .complete-message {
            color: var(--success);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .undo-bought-btn {
            padding: 0.4rem 0.75rem;
            background: white;
            border: 1px solid var(--light-navy);
            border-radius: var(--radius-sm);
            color: var(--light-navy);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .undo-bought-btn:hover {
            background: var(--light-navy);
            color: white;
        }

        .store-link-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.4rem 0.75rem;
            background: var(--cream);
            border-radius: var(--radius-sm);
            color: var(--navy);
            font-size: 0.8rem;
            text-decoration: none;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }

        .store-link-btn:hover {
            background: var(--gold-light);
            color: var(--navy);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }

        .registry-item.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border-radius: var(--radius-lg);
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.08);
            border: 1px solid rgba(26, 54, 93, 0.06);
            /* Fix blurry text from 3D transforms */
            transform: translateZ(0);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        .card-back {
            transform: rotateY(180deg) translateZ(0);
            display: flex;
            flex-direction: column;
        }

        /* Front of card - Minimalist */
        .card-front-image {
            height: 55%;
            overflow: hidden;
            position: relative;
        }

        .card-front-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        /* Dual image collage on front */
        .card-front-image-collage {
            display: flex;
            height: 100%;
        }

        .card-front-image-collage img {
            width: 50%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .card-front-image-collage img:first-child {
            border-right: 2px solid white;
        }

        .registry-item:hover .card-front-image img,
        .registry-item:hover .card-front-image-collage img {
            transform: scale(1.05);
        }

        .card-front-content {
            padding: 1rem 1.25rem 0.75rem;
            height: 45%;
            display: flex;
            flex-direction: column;
        }

        .card-front-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--navy);
            margin-bottom: 0.25rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-front-price {
            font-size: 1.15rem;
            font-weight: 700;
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .card-front-progress {
            margin-top: auto;
            padding-bottom: 1.75rem;
        }

        .card-front-progress-bar {
            height: 6px;
            background: rgba(26, 54, 93, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.35rem;
        }

        .card-front-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .card-front-progress-text {
            font-size: 0.75rem;
            color: var(--light-navy);
            display: flex;
            justify-content: space-between;
        }

        .card-tap-hint {
            position: absolute;
            bottom: 0.6rem;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem;
            color: var(--light-navy);
            opacity: 0.5;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            white-space: nowrap;
        }

        /* Back of card - Payment options */
        .card-back-header {
            padding: 1rem 1.25rem;
            border-bottom: 1px solid rgba(26, 54, 93, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-back-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--navy);
        }

        .card-back-close {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(26, 54, 93, 0.06);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--navy);
            transition: all var(--transition-fast);
        }

        .card-back-close:hover {
            background: var(--error-light);
            color: var(--error);
        }

        .card-back-content {
            padding: 1rem 1.25rem;
            flex: 1;
            overflow-y: auto;
        }

        .card-back-description {
            font-size: 0.85rem;
            color: var(--light-navy);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .card-back-section {
            margin-bottom: 1rem;
        }

        .card-back-section-title {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--light-navy);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .store-link-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem;
            background: rgba(26, 54, 93, 0.04);
            border: 1px solid rgba(26, 54, 93, 0.1);
            border-radius: var(--radius-sm);
            color: var(--navy);
            font-size: 0.85rem;
            font-weight: 500;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .store-link-btn:hover {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
        }

        .bought-in-store-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem;
            background: var(--success-light);
            border: 1px solid var(--success);
            border-radius: var(--radius-sm);
            color: var(--success);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .bought-in-store-btn:hover {
            background: var(--success);
            color: white;
        }

        .card-payment-section {
            padding: 1rem 1.25rem;
            border-top: 1px solid rgba(26, 54, 93, 0.08);
            background: rgba(26, 54, 93, 0.02);
        }

        .quick-amounts-mini {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.35rem;
            margin-bottom: 0.5rem;
        }

        .quick-amount-mini {
            padding: 0.5rem;
            background: white;
            border: 1px solid rgba(26, 54, 93, 0.1);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--navy);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .quick-amount-mini:hover,
        .quick-amount-mini.selected {
            background: var(--navy);
            color: white;
            border-color: var(--navy);
        }

        /* Gift card voucher buttons */
        .gift-card-amounts {
            grid-template-columns: 1fr 1fr !important;
        }

        .voucher-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            padding: 0.6rem 0.5rem !important;
            background: linear-gradient(135deg, var(--gold-light), var(--gold)) !important;
            color: white !important;
            border: none !important;
            font-size: 0.75rem !important;
        }

        .voucher-btn:hover {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark, #c9a227)) !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .voucher-btn i {
            font-size: 0.7rem;
        }

        .amount-input-mini {
            width: 100%;
            padding: 0.6rem 0.75rem;
            border: 1px solid rgba(26, 54, 93, 0.1);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            margin-bottom: 0.5rem;
        }

        .amount-input-mini:focus {
            border-color: var(--navy);
            outline: none;
        }

        .contribute-btn-mini {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, var(--navy), var(--light-navy));
            color: white;
            border: none;
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .contribute-btn-mini:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.25);
        }

        /* Completed state */
        .registry-item.completed .card-front-progress-fill {
            background: var(--success);
        }

        .completed-badge {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: var(--success);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .watchlist-badge {
            position: absolute;
            bottom: 0.75rem;
            left: 0.75rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.65rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            backdrop-filter: blur(4px);
        }

        .full-amount-notice {
            background: var(--cream);
            color: var(--light-navy);
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .full-amount-btn {
            width: 100%;
            padding: 0.75rem !important;
            font-size: 1rem !important;
        }

        .undo-bought-btn {
            width: 100%;
            padding: 0.5rem 1rem;
            background: var(--cream);
            color: var(--light-navy);
            border: 1px solid var(--light-navy);
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }

        .undo-bought-btn:hover {
            background: var(--light-navy);
            color: white;
        }

        .item-image-container {
            position: relative;
            height: 320px;
            overflow: hidden;
        }

        .item-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .registry-item:hover .item-image {
            transform: scale(1.1);
        }

        .item-images-collage {
            display: flex;
            height: 250px;
            overflow: hidden;
        }

        .item-image-collage {
            width: 50%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s ease;
        }

        .item-image-collage:first-child {
            border-right: 2px solid var(--white);
        }

        .registry-item:hover .item-image-collage {
            transform: scale(1.08);
        }

        .item-category {
            position: absolute;
            top: 1rem;
            left: 1rem;
            background: rgba(30, 58, 95, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            z-index: 2;
        }

        .completion-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            z-index: 2;
        }

        .item-content {
            padding: 2rem;
        }

        .item-title {
            font-size: 1.6rem;
            font-weight: bold;
            color: var(--navy);
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        .item-description {
            color: var(--light-navy);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            font-size: 1rem;
        }

        .store-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--navy);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding: 0.5rem 1rem;
            background: var(--beige);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .store-link:hover {
            background: var(--navy);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .store-link i {
            font-size: 0.8rem;
        }

        .price-info {
            margin-bottom: 2rem;
        }

        .target-price {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--navy);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-container {
            background: rgba(26, 54, 93, 0.08);
            border-radius: var(--radius-full);
            height: 10px;
            margin-bottom: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, var(--navy) 0%, var(--botanical-blue) 50%, var(--gold) 100%);
            height: 100%;
            border-radius: var(--radius-full);
            transition: width 1s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.4) 50%, transparent 100%);
            animation: shimmer 2s infinite linear;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            color: var(--navy);
            margin-top: 0.8rem;
            font-weight: 600;
        }

        .contribution-section {
            border-top: 2px solid var(--beige);
            padding-top: 1.5rem;
        }

        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .quick-amount {
            background: rgba(26, 54, 93, 0.06);
            border: 2px solid transparent;
            padding: 0.75rem 0.5rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-spring);
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--navy);
            font-weight: 600;
            text-align: center;
        }

        .quick-amount:hover {
            background: rgba(26, 54, 93, 0.12);
            transform: translateY(-2px);
        }

        .quick-amount.selected {
            background: var(--navy);
            color: var(--white);
            border-color: var(--navy);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.25);
        }

        .quick-amount:active {
            transform: scale(0.95);
        }

        .amount-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid rgba(26, 54, 93, 0.1);
            border-radius: var(--radius-md);
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            transition: all var(--transition-normal);
            background: var(--white);
        }

        .amount-input:focus {
            border-color: var(--navy);
            box-shadow: 0 0 0 4px rgba(26, 54, 93, 0.1);
            outline: none;
        }

        .amount-input::placeholder {
            color: rgba(26, 54, 93, 0.4);
            font-weight: 500;
        }

        .contribute-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-full);
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-spring);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .contribute-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-light) 100%);
            opacity: 0;
            transition: opacity var(--transition-normal);
        }

        .contribute-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 28px rgba(26, 54, 93, 0.35);
        }

        .contribute-btn:hover::before {
            opacity: 1;
        }

        .contribute-btn:active {
            transform: translateY(-1px) scale(0.98);
        }

        .contribute-btn span {
            position: relative;
            z-index: 1;
        }

        .contribute-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .no-price-item {
            text-align: center;
            color: var(--light-navy);
            font-style: italic;
            background: linear-gradient(135deg, var(--beige), var(--cream));
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border: 2px dashed var(--navy);
        }

        .no-price-item .heart {
            font-size: 1.5rem;
            color: var(--gold);
            margin: 0 0.5rem;
        }

        .completed {
            border-color: var(--success) !important;
        }

        .completed .progress-bar {
            background: linear-gradient(90deg, var(--success) 0%, #16a34a 100%);
        }

        .completed .progress-container {
            background: var(--success-light);
        }

        /* Schedule Section */
        #schedule {
            background: transparent;
        }

        #schedule::after {
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 1200 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,40 C200,80 400,10 600,50 C800,90 1000,30 1200,60 L1200,120 L0,120 Z' fill='%23ffffff'/%3E%3C/svg%3E");
        }

        .timeline {
            position: relative;
            max-width: 700px;
            margin: 0 auto;
            padding: 1rem 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(
                to bottom,
                transparent,
                rgba(26, 54, 93, 0.15) 10%,
                rgba(26, 54, 93, 0.15) 90%,
                transparent
            );
            transform: translateX(-50%);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 4rem;
            display: flex;
            align-items: center;
        }

        .timeline-item:nth-child(odd) {
            flex-direction: row;
        }

        .timeline-item:nth-child(even) {
            flex-direction: row-reverse;
        }

        .timeline-content {
            flex: 1;
            background: white;
            padding: 1.5rem 1.75rem;
            border-radius: var(--radius-md);
            box-shadow: 0 2px 16px rgba(26, 54, 93, 0.04);
            border: 1px solid rgba(26, 54, 93, 0.06);
            margin: 0 2rem;
            transition: all var(--transition-normal);
        }

        .timeline-content:hover {
            transform: none;
            box-shadow: 0 4px 24px rgba(26, 54, 93, 0.08);
            border-color: rgba(212, 175, 55, 0.2);
        }

        .timeline-content h3 {
            color: var(--navy);
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .timeline-time {
            color: var(--gold);
            font-weight: 500;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .timeline-content p {
            color: var(--navy);
            opacity: 0.8;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .timeline-icon {
            width: 44px;
            height: 44px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gold);
            flex-shrink: 0;
            border: 2px solid rgba(26, 54, 93, 0.08);
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.06);
            z-index: 3;
        }

        .timeline-icon svg {
            width: 20px;
            height: 20px;
            fill: var(--gold);
            position: relative;
        }

        /* Accommodation Section */
        #accommodation {
            background: linear-gradient(135deg, var(--cream) 0%, var(--white) 50%, var(--beige) 100%);
        }

        .accommodation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .accommodation-card {
            background: var(--white);
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 10px 25px var(--shadow);
            border: 3px solid var(--beige);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .accommodation-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 35px var(--shadow-lg);
        }

        .accommodation-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--botanical-blue), var(--navy));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: white;
        }

        .accommodation-card h3 {
            color: var(--navy);
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
        }

        .accommodation-card p {
            color: var(--light-navy);
            line-height: 1.8;
            margin-bottom: 1rem;
            text-align: left;
        }

        .hotel-item, .travel-info, .parking-info {
            text-align: left;
        }

        .hotel-item h4 {
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        /* FAQ Section */
        #faq {
            background: transparent;
        }

        .faq-container {
            max-width: 700px;
            margin: 0 auto;
        }

        .faq-item {
            background: white;
            border-radius: var(--radius-sm);
            margin-bottom: 0.75rem;
            overflow: hidden;
            border: 1px solid rgba(26, 54, 93, 0.06);
            transition: all var(--transition-normal);
        }

        .faq-item:hover {
            border-color: rgba(26, 54, 93, 0.12);
        }

        .faq-item.active {
            border-color: rgba(212, 175, 55, 0.3);
            box-shadow: 0 4px 16px rgba(26, 54, 93, 0.06);
        }

        .faq-question {
            padding: 1.25rem 1.5rem;
            background: transparent;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            transition: background var(--transition-normal);
        }

        .faq-question:hover {
            background: rgba(26, 54, 93, 0.02);
        }

        .faq-question h3 {
            color: var(--navy);
            font-size: 1rem;
            font-weight: 500;
            margin: 0;
            flex: 1;
        }

        /* Hide icons in FAQ questions */
        .faq-question h3 i {
            display: none;
        }

        .faq-icon {
            color: var(--light-navy);
            width: 24px;
            height: 24px;
            transition: transform var(--transition-normal);
            flex-shrink: 0;
        }

        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }

        .faq-answer {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.3s ease-out;
            padding: 0 1.5rem;
        }

        .faq-answer > div,
        .faq-answer > p {
            overflow: hidden;
        }

        .faq-item.active .faq-answer {
            grid-template-rows: 1fr;
            padding-bottom: 1.25rem;
        }

        .faq-answer p {
            color: var(--navy);
            opacity: 0.75;
            line-height: 1.7;
            font-size: 0.9rem;
            margin: 0;
            padding-top: 0.25rem;
        }

        .faq-answer a {
            color: var(--botanical-blue);
            text-decoration: none;
            font-weight: 500;
        }

        .faq-answer a:hover {
            text-decoration: underline;
        }

        /* Photo Gallery Section */
        #gallery {
            background: transparent;
        }

        /* Collage-style photo grid */
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-auto-rows: 150px;
            gap: 0.75rem;
            margin-top: 2rem;
        }

        /* Create collage effect with varying sizes */
        .photo-item:nth-child(1) { grid-column: span 2; grid-row: span 2; }
        .photo-item:nth-child(4) { grid-column: span 2; }
        .photo-item:nth-child(5) { grid-row: span 2; }
        .photo-item:nth-child(7) { grid-column: span 2; grid-row: span 2; }

        .photo-item {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-md);
            box-shadow: 0 2px 12px rgba(26, 54, 93, 0.08);
            transition: all var(--transition-normal);
            background: linear-gradient(135deg, var(--beige), var(--cream));
        }

        .photo-item:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 24px rgba(26, 54, 93, 0.15);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.4s ease;
        }

        .photo-item:hover img {
            transform: scale(1.05);
        }

        .photo-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--light-navy);
        }

        .photo-placeholder i {
            font-size: 2.5rem;
            color: var(--navy);
            opacity: 0.3;
            margin-bottom: 0.5rem;
        }

        .photo-placeholder p {
            font-size: 0.9rem;
            opacity: 0.6;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
        }

        footer p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* Payment Modal */
        .payment-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .payment-modal-content {
            background-color: var(--white);
            margin: 2% auto;
            padding: 0;
            border-radius: 25px;
            width: 90%;
            max-width: 500px;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
            margin-bottom: 2rem;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .payment-modal-header {
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .payment-modal-header h3 {
            margin: 0;
            font-size: 1.5rem;
        }

        .payment-modal-body {
            padding: 2rem;
        }

        .payment-amount {
            background: var(--beige);
            padding: 1rem;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 2rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--navy);
        }

        .form-field {
            margin-bottom: 1.5rem;
        }

        .form-field label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--navy);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-field input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--beige);
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-field input:focus,
        .form-field textarea:focus,
        .form-field select:focus {
            border-color: var(--navy);
            box-shadow: 0 0 0 3px rgba(30, 58, 95, 0.15);
        }

        .form-field input:focus-visible,
        .form-field textarea:focus-visible,
        .form-field select:focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
        }

        #payment-element {
            padding: 1rem;
            border: 2px solid var(--beige);
            border-radius: 10px;
            background: white;
            transition: border-color 0.3s ease;
            min-height: 120px;
        }

        #payment-element.StripeElement--focus {
            border-color: var(--navy);
        }

        #payment-errors {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        .payment-message {
            color: var(--error);
            font-size: 0.9rem;
            margin-top: 1rem;
            text-align: center;
        }

        .payment-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--navy);
            padding: 2rem;
            font-size: 1rem;
        }

        .payment-loading i {
            font-size: 1.2rem;
        }

        .payment-error {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            color: var(--error);
            padding: 1.5rem;
            font-size: 0.95rem;
            background: rgba(239, 68, 68, 0.1);
            border-radius: 8px;
        }

        .payment-message.success {
            color: var(--success);
        }

        #submit-payment:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .payment-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .payment-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-btn.primary {
            background: linear-gradient(135deg, var(--navy) 0%, var(--light-navy) 100%);
            color: white;
        }

        .payment-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 58, 95, 0.3);
        }

        .payment-btn.secondary {
            background: var(--beige);
            color: var(--navy);
            border: 2px solid var(--navy);
        }

        .payment-btn.secondary:hover {
            background: var(--navy);
            color: white;
        }

        .payment-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .secure-badge {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
            color: var(--light-navy);
            font-size: 0.9rem;
        }

        /* Thank You Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            margin: 2vh auto;
            padding: 2rem;
            border-radius: var(--radius-xl);
            width: 90%;
            max-width: 480px;
            max-height: 96vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            border: 1px solid var(--glass-border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            color: var(--navy);
            background: rgba(26, 54, 93, 0.06);
            border-radius: var(--radius-full);
            transition: all var(--transition-normal);
        }

        .close:hover {
            background: var(--error-light);
            color: var(--error);
        }

        /* Toast Notifications - Modern Design */
        .toast {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            background: var(--white);
            color: var(--navy);
            padding: 1rem 1.25rem;
            border-radius: var(--radius-lg);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            z-index: 1001;
            transform: translateX(400px) scale(0.9);
            opacity: 0;
            transition: all var(--transition-spring);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 340px;
            font-size: 0.9rem;
            font-weight: 600;
            border-left: 4px solid var(--success);
        }

        .toast.show {
            transform: translateX(0) scale(1);
            opacity: 1;
        }

        .toast.error {
            border-left-color: var(--error);
        }

        .toast.error i {
            color: var(--error);
        }

        .toast.info {
            border-left-color: var(--botanical-blue);
        }

        .toast.info i {
            color: var(--botanical-blue);
        }

        .toast.warning {
            border-left-color: var(--warning);
        }

        .toast.warning i {
            color: var(--warning);
        }

        .toast.success i {
            color: var(--success);
        }

        .toast i {
            font-size: 1.2rem;
        }

        /* Accessibility - Enhanced Focus styles */
        /* Use focus-visible for better UX (only shows on keyboard navigation) */
        a:focus-visible,
        button:focus-visible,
        [role="button"]:focus-visible {
            outline: 3px solid var(--gold);
            outline-offset: 2px;
        }

        /* Filter and action buttons */
        .filter-btn:focus-visible,
        .amount-btn:focus-visible,
        .contribute-btn:focus-visible,
        .login-btn:focus-visible,
        .hero-rsvp-btn:focus-visible {
            outline: 3px solid var(--gold);
            outline-offset: 3px;
            box-shadow: 0 0 0 6px rgba(212, 175, 55, 0.3);
        }

        /* Mobile nav focus */
        .mobile-bottom-nav .nav-item:focus-visible {
            outline: 2px solid var(--gold);
            outline-offset: 2px;
            background: rgba(255,255,255,0.15);
        }

        /* Legacy keyboard navigation support */
        .keyboard-navigation *:focus {
            outline: 3px solid var(--gold) !important;
            outline-offset: 2px !important;
        }

        /* Screen reader only text */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* ARIA live region for announcements */
        #aria-live-region {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }

        /* Reduced motion preference */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Scroll-triggered animations */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(24px);
            transition: opacity 0.6s ease, transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Stagger children animations */
        .stagger-children > * {
            opacity: 0;
            transform: translateY(16px);
            transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .stagger-children.visible > *:nth-child(1) { transition-delay: 0.05s; }
        .stagger-children.visible > *:nth-child(2) { transition-delay: 0.1s; }
        .stagger-children.visible > *:nth-child(3) { transition-delay: 0.15s; }
        .stagger-children.visible > *:nth-child(4) { transition-delay: 0.2s; }
        .stagger-children.visible > *:nth-child(5) { transition-delay: 0.25s; }
        .stagger-children.visible > *:nth-child(6) { transition-delay: 0.3s; }
        .stagger-children.visible > *:nth-child(7) { transition-delay: 0.35s; }
        .stagger-children.visible > *:nth-child(8) { transition-delay: 0.4s; }

        .stagger-children.visible > * {
            opacity: 1;
            transform: translateY(0);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--light-navy);
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* ========================================
           MOBILE-FIRST RESPONSIVE DESIGN
           ======================================== */

        @media (max-width: 768px) {
            /* Hide top navigation on mobile */
            .fixed-nav {
                display: none !important;
            }

            /* Reset parallax positioning for mobile */
            .hero-background {
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                transform: none !important;
                will-change: auto;
            }

            .hero-content {
                transform: none !important;
                opacity: 1 !important;
                will-change: auto;
                padding: 1rem;
            }

            .botanical-corner {
                transform: none !important;
                will-change: auto;
                opacity: 0.2;
            }

            .botanical-top-left {
                width: 200px;
                height: 200px;
            }

            .botanical-bottom-right {
                width: 200px;
                height: 200px;
            }

            /* Mobile Hero Section */
            .hero-section {
                min-height: 100vh;
                padding-bottom: 80px;
            }

            .hero-content h1 {
                font-size: 2.5rem;
                text-shadow: 1px 2px 4px rgba(0,0,0,0.5);
            }

            .hero-content .subtitle {
                font-size: 1.8rem;
            }

            .countdown-timer {
                padding: 1rem 1.5rem;
                margin: 2rem auto 1.5rem auto;
            }

            .countdown-grid {
                gap: 0.75rem;
            }

            .countdown-number {
                font-size: 1.8rem;
            }

            .countdown-label {
                font-size: 0.7rem;
            }

            /* Mobile Login Screen */
            .login-screen {
                padding: 1rem;
            }

            .login-container {
                padding: 2rem 1.5rem;
                margin: 0.5rem;
                border-radius: 20px;
            }

            .login-container h1 {
                font-size: 1.8rem;
                margin-bottom: 0.5rem;
            }

            .login-container p {
                font-size: 1rem;
            }

            .login-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                border-radius: 30px;
                min-height: 56px; /* Touch-friendly */
            }

            #guestCode {
                font-size: 1.1rem;
                padding: 1rem;
                border-radius: 12px;
                min-height: 56px;
            }

            /* Mobile Sections */
            section {
                padding: 3rem 1rem 4rem;
                padding-bottom: 100px; /* Space for bottom nav */
            }

            section::after {
                height: 40px;
            }

            .section-title {
                font-size: 1.75rem;
                margin-bottom: 1.5rem;
            }

            .section-subtitle {
                font-size: 0.9rem;
                margin: -1rem auto 2rem;
            }

            /* Mobile Registry Grid */
            .registry-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
                padding: 0 0.5rem;
            }

            .registry-item {
                border-radius: 16px;
                overflow: hidden;
            }

            .item-image, .item-images-collage {
                height: 200px;
            }

            .item-content {
                padding: 1.25rem;
            }

            .item-content h3 {
                font-size: 1.3rem;
                margin-bottom: 0.5rem;
            }

            .item-content p {
                font-size: 0.95rem;
                line-height: 1.5;
            }

            /* Mobile Progress Bar */
            .progress-bar {
                height: 10px;
                border-radius: 5px;
            }

            .progress-info {
                flex-direction: column;
                gap: 0.25rem;
                align-items: flex-start;
            }

            /* Mobile Quick Amounts */
            .quick-amounts {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .amount-btn {
                padding: 0.9rem 1rem;
                font-size: 1rem;
                border-radius: 12px;
                min-height: 48px;
            }

            /* Mobile Contribute Button */
            .btn-contribute {
                padding: 1rem;
                font-size: 1.1rem;
                border-radius: 14px;
                min-height: 56px;
            }

            /* Mobile Controls/Filters */
            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
                padding: 1rem;
            }

            .search-box {
                max-width: none;
            }

            .search-box input {
                padding: 1rem;
                font-size: 1rem;
                min-height: 52px;
            }

            .filter-btns {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                justify-content: center;
            }

            .filter-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
                border-radius: 20px;
                flex: 0 0 auto;
            }

            /* Mobile About Section */
            .about-content-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .about-text p {
                font-size: 1rem;
                line-height: 1.7;
            }

            .wedding-details-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .detail-card {
                padding: 1.5rem;
            }

            /* Mobile Timeline */
            .timeline::before {
                left: 20px;
            }

            .timeline-item {
                flex-direction: row !important;
            }

            .timeline-content {
                margin-left: 60px;
                margin-right: 0;
                padding: 1.25rem;
            }

            .timeline-icon {
                left: 20px;
                transform: translateX(0);
                width: 40px;
                height: 40px;
            }

            /* Mobile Gallery */
            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: 120px;
                gap: 0.5rem;
            }

            .gallery-grid .gallery-photo-item:nth-child(1) { grid-column: span 2; grid-row: span 2; }
            .gallery-grid .gallery-photo-item:nth-child(5) { grid-column: span 1; }
            .gallery-grid .gallery-photo-item:nth-child(6) { grid-row: span 1; }

            .photo-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: 120px;
            }

            .photo-item:nth-child(1) { grid-column: span 2; grid-row: span 2; }
            .photo-item:nth-child(4) { grid-column: span 1; }
            .photo-item:nth-child(5) { grid-row: span 1; }
            .photo-item:nth-child(7) { grid-column: span 2; grid-row: span 1; }

            /* Mobile Featured Section */
            .featured-section {
                padding: 1.5rem 1rem;
                margin: 0 -0.5rem 1.5rem -0.5rem;
                border-radius: 0;
            }

            .featured-carousel {
                gap: 1rem;
                padding: 0.5rem 0;
            }

            .featured-item {
                min-width: 260px;
                max-width: 280px;
            }

            /* Mobile Almost Funded Section */
            .almost-funded-section {
                padding: 1.5rem 1rem;
                margin: 0 -0.5rem 1.5rem -0.5rem;
            }

            /* Mobile Modals */
            .modal-content {
                margin: 5% auto;
                padding: 1.5rem;
                width: 95%;
                max-width: none;
                border-radius: 20px;
            }

            .modal-content h2 {
                font-size: 1.5rem;
            }

            /* Mobile Form Elements */
            input, textarea, select {
                font-size: 16px !important; /* Prevent iOS zoom */
            }

            .login-options {
                flex-direction: column;
            }

            /* Mobile FAQ */
            .faq-item {
                padding: 1rem;
            }

            .faq-question {
                font-size: 1rem;
                padding-right: 2rem;
            }

            /* Mobile RSVP Button */
            .hero-rsvp-btn {
                padding: 1rem 2rem;
                font-size: 1.1rem;
                margin-top: 1rem;
            }

            /* Mobile Stats */
            .stat-number {
                font-size: 2rem;
            }

            .stat-label {
                font-size: 0.9rem;
            }
        }

        /* Extra Small Screens */
        @media (max-width: 480px) {
            section {
                padding: 2.5rem 0.75rem;
                padding-bottom: 90px;
            }

            .hero-content h1 {
                font-size: 2rem;
            }

            .hero-content .subtitle {
                font-size: 1.5rem;
            }

            .section-title {
                font-size: 1.75rem;
            }

            .login-container {
                padding: 1.5rem 1.25rem;
            }

            .countdown-number {
                font-size: 1.5rem;
            }

            .item-content {
                padding: 1rem;
            }

            .quick-amounts {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
            }

            .amount-btn {
                padding: 0.75rem;
                font-size: 0.95rem;
            }

            .gallery-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-rows: 100px;
                gap: 0.35rem;
            }
        }

        /* Safe area insets for notched phones */
        @supports (padding: max(0px)) {
            .mobile-bottom-nav {
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }

            section:last-of-type {
                padding-bottom: max(100px, calc(80px + env(safe-area-inset-bottom)));
            }
        }

        /* Reduced motion accessibility - disable all parallax and animations */
        @media (prefers-reduced-motion: reduce) {
            .hero-background,
            .hero-content,
            .botanical-corner {
                transform: none !important;
                will-change: auto;
                animation: none;
            }

            .hero-content {
                opacity: 1 !important;
            }

            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* === NEW ENHANCEMENT STYLES === */

        /* Hero RSVP Button */
        .hero-rsvp-btn {
            margin-top: 0;
            padding: 1rem 2.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--white);
            background: var(--gold);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.4);
            z-index: 10;
            position: relative;
        }

        .hero-rsvp-btn:hover {
            background: var(--botanical-blue);
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(74, 124, 158, 0.5);
        }

        .hero-rsvp-btn i {
            margin-right: 0.5rem;
        }

        .hero-wedding-info {
            margin-top: 2rem;
            font-size: 1.1rem;
            color: var(--white);
            opacity: 0.95;
            font-weight: 400;
        }

        /* Modal Header */
        .modal-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--beige);
        }

        .modal-header i {
            font-size: 3rem;
            color: var(--botanical-blue);
            margin-bottom: 1rem;
        }

        .modal-header h2 {
            color: var(--navy);
            margin-bottom: 0.5rem;
        }

        .modal-subtitle {
            color: var(--botanical-blue);
            font-size: 1rem;
            margin: 0;
        }

        /* Form Fields for Modals */
        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-row:has(.form-field:nth-child(2)) {
            grid-template-columns: 1fr 1fr;
        }

        .form-field {
            margin-bottom: 1.5rem;
            text-align: left;
        }

        .form-field label {
            display: block;
            margin-bottom: 0.75rem;
            color: var(--navy);
            font-weight: 600;
            font-size: 0.95rem;
        }

        .form-field label i {
            margin-right: 0.5rem;
            color: var(--botanical-blue);
            width: 20px;
            display: inline-block;
        }

        .form-field input,
        .form-field select,
        .form-field textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--beige);
            border-radius: 10px;
            font-family: 'Lato', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-field input:focus,
        .form-field select:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: var(--botanical-blue);
            box-shadow: 0 0 0 4px rgba(74, 124, 158, 0.1);
            transform: translateY(-2px);
        }

        .form-field textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Radio Group */
        .radio-group {
            display: grid;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            position: relative;
            display: block;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        .radio-label {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem 1.5rem;
            background: var(--cream);
            border: 2px solid var(--beige);
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .radio-label i {
            font-size: 1.5rem;
            color: var(--botanical-blue);
        }

        .radio-label strong {
            display: block;
            color: var(--navy);
            margin-bottom: 0.25rem;
        }

        .radio-label small {
            display: block;
            color: var(--light-navy);
            font-size: 0.85rem;
        }

        .radio-option:hover .radio-label {
            border-color: var(--botanical-blue);
            transform: translateX(5px);
        }

        .radio-option input[type="radio"]:checked + .radio-label {
            background: var(--botanical-blue);
            border-color: var(--botanical-blue);
            color: white;
        }

        .radio-option input[type="radio"]:checked + .radio-label i,
        .radio-option input[type="radio"]:checked + .radio-label strong,
        .radio-option input[type="radio"]:checked + .radio-label small {
            color: white;
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #0d9668;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .btn-large {
            width: 100%;
            padding: 1.25rem 2rem;
            font-size: 1.1rem;
            margin-top: 1rem;
        }

        .rsvp-modal-content {
            max-width: 700px;
        }

        /* Guest Book Entries */
        .guest-book-entry {
            background: var(--cream);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--botanical-blue);
        }

        .guest-book-entry strong {
            color: var(--navy);
            display: block;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .guest-book-entry p {
            color: var(--light-navy);
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        .guest-book-entry small {
            color: var(--botanical-blue);
            font-size: 0.85rem;
            font-style: italic;
        }

        #guestBookEntries {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 2rem;
            padding-right: 0.5rem;
        }

        #guestBookEntries::-webkit-scrollbar {
            width: 8px;
        }

        #guestBookEntries::-webkit-scrollbar-track {
            background: var(--beige);
            border-radius: 4px;
        }

        #guestBookEntries::-webkit-scrollbar-thumb {
            background: var(--botanical-blue);
            border-radius: 4px;
        }

        /* Mobile Bottom Navigation - Glassmorphic Design (Always Visible) */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: auto;
            max-width: calc(100% - 32px);
            background: rgba(26, 54, 93, 0.92);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            z-index: 999;
            box-shadow: 0 8px 32px rgba(0,0,0,0.25),
                        0 0 0 1px rgba(255,255,255,0.1);
            border-radius: var(--radius-full);
            padding: 0.5rem 0.75rem;
        }

        /* Remove hide on scroll - always visible */
        .mobile-bottom-nav.nav-hidden {
            transform: translateX(-50%); /* Keep centered */
        }

        @media (max-width: 768px) {
            /* Only show nav when logged in (main-visible on body) */
            body.main-visible .mobile-bottom-nav {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 0.25rem;
                min-height: 60px;
            }

            body.main-visible {
                padding-bottom: 90px;
            }
        }

        .mobile-bottom-nav .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            padding: 0.5rem 1rem;
            transition: all var(--transition-spring);
            text-align: center;
            border-radius: var(--radius-full);
            position: relative;
            -webkit-tap-highlight-color: transparent;
            min-width: 56px;
        }

        .mobile-bottom-nav .nav-item::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--gold), var(--gold-light));
            border-radius: var(--radius-full);
            opacity: 0;
            transform: scale(0.8);
            transition: all var(--transition-spring);
            z-index: -1;
        }

        .mobile-bottom-nav .nav-item.active::before {
            opacity: 1;
            transform: scale(1);
        }

        .mobile-bottom-nav .nav-item:hover {
            color: rgba(255,255,255,0.95);
        }

        .mobile-bottom-nav .nav-item.active {
            color: var(--navy);
        }

        .mobile-bottom-nav .nav-item:active {
            transform: scale(0.92);
        }

        .mobile-bottom-nav .nav-item svg {
            width: 22px;
            height: 22px;
            margin-bottom: 0.3rem;
            transition: transform 0.2s ease;
            fill: currentColor;
        }

        .mobile-bottom-nav .nav-item.active svg {
            transform: scale(1.1);
        }

        .mobile-bottom-nav .nav-item span {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* Contributor count badge */
        .contributor-count {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.85rem;
            color: var(--botanical-blue);
            margin-top: 0.5rem;
        }

        /* Favorite Button */
        .favorite-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.95);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: #ccc;
            z-index: 5;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            -webkit-tap-highlight-color: transparent;
        }

        .favorite-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .favorite-btn.active {
            color: var(--gold);
            background: linear-gradient(135deg, #fff9e6 0%, #fff 100%);
        }

        .favorite-btn.active i {
            animation: favoritePopIn 0.4s ease;
        }

        @keyframes favoritePopIn {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* Favorites badge on filter button */
        .favorites-count {
            background: var(--gold);
            color: var(--navy);
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.15rem 0.4rem;
            border-radius: 10px;
            margin-left: 0.3rem;
        }

        .contributor-count i {
            font-size: 0.9rem;
        }

        /* Almost Funded Section */
        .almost-funded-section {
            background: linear-gradient(135deg, var(--cream) 0%, #fff9e6 100%);
            padding: 3rem 2rem;
            margin-bottom: 2rem;
            border-radius: 20px;
            border: 2px solid var(--gold);
        }

        .almost-funded-section h3 {
            color: var(--navy);
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
        }

        .almost-funded-section .subtitle {
            color: var(--light-navy);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .almost-funded-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .almost-funded-item {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .almost-funded-item .item-name {
            font-weight: bold;
            color: var(--navy);
            font-size: 1.1rem;
        }

        .almost-funded-item .progress-container {
            height: 12px;
            background: var(--beige);
            border-radius: 6px;
            overflow: hidden;
        }

        .almost-funded-item .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), #f0c14b);
            border-radius: 6px;
            transition: width 0.5s ease;
        }

        .almost-funded-item .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--light-navy);
        }

        .almost-funded-item .contribute-link {
            color: var(--navy);
            font-weight: bold;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            margin-top: 0.5rem;
        }

        .almost-funded-item .contribute-link:hover {
            color: var(--gold);
        }

        /* Celebration overlay for 100% funded */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(30, 58, 95, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            animation: fadeIn 0.5s ease;
        }

        .celebration-content {
            text-align: center;
            color: white;
            padding: 2rem;
            max-width: 500px;
        }

        .celebration-content h2 {
            font-family: 'Great Vibes', cursive;
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gold);
        }

        .celebration-content p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .celebration-content .item-name {
            font-weight: bold;
            font-size: 1.4rem;
            color: var(--gold);
            margin: 1rem 0;
        }

        .celebration-close {
            background: var(--gold);
            color: var(--navy);
            border: none;
            padding: 1rem 2rem;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .celebration-close:hover {
            transform: scale(1.05);
        }

        /* Lazy loading placeholder */
        .lazy-image {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .lazy-image.loaded {
            opacity: 1;
        }

        .image-placeholder {
            background: linear-gradient(90deg, var(--beige) 25%, var(--cream) 50%, var(--beige) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Button ripple effect */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }

        .btn-ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-ripple:active::after {
            width: 300px;
            height: 300px;
        }

        /* Smooth hover transitions for all buttons */
        button, .btn, a.btn {
            transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-normal);
        }

        /* Quick amount button hover enhancement */
        .quick-amount {
            transition: all var(--transition-fast);
        }

        .quick-amount:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .quick-amount:active {
            transform: scale(0.98);
        }

        /* Card hover enhancement */
        .registry-item {
            transition: transform var(--transition-normal), box-shadow var(--transition-normal);
        }

        .registry-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--shadow-lg), 0 0 0 1px var(--gold-light);
        }

        /* Progress bar animation */
        .progress-bar {
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Smooth image transitions */
        .item-image, .item-image-collage {
            transition: transform var(--transition-normal);
        }

        .registry-item:hover .item-image,
        .registry-item:hover .item-image-collage {
            transform: scale(1.05);
        }

        /* Loading spinner enhancement */
        .fa-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Featured Items Section */
        .featured-section {
            margin-bottom: 3rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
            border-radius: 20px;
            color: white;
        }

        .featured-section h3 {
            text-align: center;
            margin-bottom: 0.5rem;
            font-size: 1.5rem;
            color: var(--gold);
        }

        .featured-section .subtitle {
            text-align: center;
            margin-bottom: 1.5rem;
            opacity: 0.9;
            font-size: 1rem;
        }

        .featured-carousel {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            padding: 0.5rem;
            scrollbar-width: none;
        }

        .featured-carousel::-webkit-scrollbar {
            display: none;
        }

        .featured-item {
            flex: 0 0 280px;
            scroll-snap-align: start;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform var(--transition-normal);
        }

        .featured-item:hover {
            transform: translateY(-5px);
        }

        .featured-item-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
        }

        .featured-item-content {
            padding: 1rem;
        }

        .featured-item-name {
            font-weight: bold;
            color: var(--navy);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .featured-item-progress {
            height: 8px;
            background: var(--beige);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .featured-item-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-light));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .featured-item-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--light-navy);
        }

        .featured-item-link {
            display: block;
            text-align: center;
            padding: 0.75rem;
            background: var(--navy);
            color: white;
            text-decoration: none;
            font-weight: bold;
            margin-top: 0.75rem;
            border-radius: 8px;
            transition: background var(--transition-fast);
        }

        .featured-item-link:hover {
            background: var(--gold);
            color: var(--navy);
        }

        @media (min-width: 768px) {
            .featured-carousel {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                overflow-x: visible;
            }

            .featured-item {
                flex: none;
            }
        }

        /* Skeleton Loader */
        .skeleton {
            background: linear-gradient(90deg, var(--beige) 25%, #e8e4df 50%, var(--beige) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
            border-radius: 8px;
        }

        .skeleton-text {
            height: 1rem;
            margin-bottom: 0.5rem;
        }

        .skeleton-text.short {
            width: 60%;
        }

        .skeleton-image {
            height: 200px;
            border-radius: 15px 15px 0 0;
        }

        .skeleton-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .skeleton-card-content {
            padding: 1.5rem;
        }

        /* Gallery skeleton specific styles */
        .gallery-skeleton {
            min-height: 150px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Content fade-in when loaded - gallery only (registry has its own animation) */
        .gallery-photo-item {
            animation: contentFadeIn 0.3s ease-out forwards;
        }

        @keyframes contentFadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Fade In Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        /* Engagement Photo Section */
        .engagement-photo-section {
            margin-top: 3rem;
            text-align: center;
            padding: 2rem;
        }

        .engagement-photo {
            max-width: 600px;
            width: 100%;
            border-radius: 20px;
            box-shadow: 0 15px 40px var(--shadow-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 5px solid var(--beige);
        }

        .engagement-photo:hover {
            transform: scale(1.05);
            box-shadow: 0 20px 50px var(--shadow-lg);
        }

        .photo-caption {
            margin-top: 1.5rem;
            font-family: 'Great Vibes', cursive;
            font-size: 2rem;
            color: var(--botanical-blue);
        }

        /* Timeline Dress Code */
        .timeline-dress-code {
            margin-top: 0.75rem;
            padding: 0.5rem 0.75rem;
            background: rgba(74, 124, 158, 0.1);
            border-radius: 6px;
            color: var(--botanical-blue);
            font-size: 0.85rem;
            font-weight: 500;
            display: inline-block;
        }

        .timeline-dress-code i {
            margin-right: 0.4rem;
            font-size: 0.8rem;
        }

        /* Featured Items & Almost Funded Sections */
        .featured-items,
        .almost-funded {
            margin-bottom: 3rem;
        }

        .featured-items h3,
        .almost-funded h3 {
            color: var(--navy);
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .featured-items h3 i {
            color: var(--gold);
        }

        .almost-funded h3 i {
            color: var(--warning);
        }

        /* Photo Upload Button */
        .upload-btn {
            padding: 0.875rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--white);
            background: var(--botanical-blue);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(74, 124, 158, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .upload-btn:hover {
            background: var(--navy);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 58, 95, 0.4);
        }

        .upload-btn i {
            font-size: 1.1rem;
        }

        /* Gallery Grid */
        /* User-uploaded gallery collage */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-auto-rows: 140px;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .gallery-grid .gallery-photo-item:nth-child(1) { grid-column: span 2; grid-row: span 2; }
        .gallery-grid .gallery-photo-item:nth-child(5) { grid-column: span 2; }
        .gallery-grid .gallery-photo-item:nth-child(6) { grid-row: span 2; }

        .gallery-photo-item {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-sm);
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.06);
            cursor: pointer;
            transition: all var(--transition-normal);
        }

        .gallery-photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px var(--shadow-lg);
        }

        .gallery-photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        @media (max-width: 768px) {
            .gallery-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Scroll progress indicator -->
    <div class="nav-progress"></div>

    <!-- ARIA Live Region for screen reader announcements -->
    <div id="aria-live-region" aria-live="polite" aria-atomic="true" role="status"></div>
    <!-- Login Screen - Multi-Step Auth Flow -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container" id="authContainer">
            <!-- Step Indicator -->
            <div class="auth-steps" id="authSteps">
                <div class="auth-step active" data-step="1">
                    <span class="step-number">1</span>
                    <span class="step-label">Password</span>
                </div>
                <div class="auth-step" data-step="2">
                    <span class="step-number">2</span>
                    <span class="step-label">Your Name</span>
                </div>
                <div class="auth-step" data-step="3">
                    <span class="step-number">3</span>
                    <span class="step-label">RSVP</span>
                </div>
            </div>

            <h1> Samuel & Beatrice </h1>
            <p class="serif-font" style="font-size: 1.4rem; margin-bottom: 1rem;">March 14th, 2026</p>

            <!-- STEP 1: Password Entry -->
            <div class="auth-step-content active" id="step1Content">
                <p>Enter the wedding password to continue</p>
                <div class="form-group">
                    <label for="guestCode"><i class="fas fa-lock"></i> Wedding Password</label>
                    <input type="text" id="guestCode" placeholder="Enter password" maxlength="30" autocomplete="off">
                </div>
                <button class="login-btn" id="loginBtn">
                    <i class="fas fa-arrow-right"></i> Continue
                </button>
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--cream); border-radius: 10px; border: 2px solid var(--beige);">
                    <p style="font-size: 0.9rem; color: var(--light-navy); margin: 0;">
                        <i class="fas fa-qrcode"></i> <strong>Scan QR Code:</strong> The password is embedded in your QR code invitation!
                    </p>
                </div>
            </div>

            <!-- STEP 2: Name Entry -->
            <div class="auth-step-content" id="step2Content">
                <p>Please enter your full name as it appears on your invitation</p>
                <div class="form-group">
                    <label for="guestName"><i class="fas fa-user"></i> Your Full Name</label>
                    <input type="text" id="guestName" placeholder="e.g. John Smith" maxlength="50" autocomplete="name">
                </div>
                <button class="login-btn" id="findNameBtn">
                    <i class="fas fa-search"></i> Find My Name
                </button>
                <div id="nameLookupError" class="auth-error" style="display: none;"></div>
                <button class="back-btn" onclick="registryApp.goToStep(1)">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>

            <!-- STEP 3: RSVP Form -->
            <div class="auth-step-content" id="step3Content">
                <p id="rsvpGreeting">Hi there! Please let us know if you can make it.</p>

                <div class="form-group">
                    <label><i class="fas fa-calendar-check"></i> Will you be attending?</label>
                    <div class="rsvp-options">
                        <label class="rsvp-option">
                            <input type="radio" name="rsvpAttending" value="yes">
                            <span class="rsvp-label yes"><i class="fas fa-check-circle"></i> Yes, I'll be there!</span>
                        </label>
                        <label class="rsvp-option">
                            <input type="radio" name="rsvpAttending" value="no">
                            <span class="rsvp-label no"><i class="fas fa-times-circle"></i> Sorry, can't make it</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="rsvpEmail"><i class="fas fa-envelope"></i> Your Email (for confirmation)</label>
                    <input type="email" id="rsvpEmail" placeholder="your@email.com" autocomplete="email">
                    <small style="color: var(--light-navy); font-size: 0.8rem;">We'll send you a confirmation with the registry link</small>
                </div>

                <div id="attendingDetails" style="display: none;">
                    <div class="form-group">
                        <label for="rsvpDietary"><i class="fas fa-utensils"></i> Dietary Requirements (optional)</label>
                        <input type="text" id="rsvpDietary" placeholder="e.g. Vegetarian, Gluten-free">
                    </div>
                </div>

                <!-- Family RSVP Section (shown if family members exist) -->
                <div id="familyRsvpSection" style="display: none;">
                    <div class="family-rsvp-header">
                        <i class="fas fa-users"></i>
                        <span>RSVP for family members too?</span>
                    </div>
                    <div id="familyMembersList" class="family-members-list"></div>
                </div>

                <div class="form-group">
                    <label for="rsvpMessage"><i class="fas fa-comment"></i> Message for Sam & Bea (optional)</label>
                    <textarea id="rsvpMessage" placeholder="Share your well wishes..." rows="2"></textarea>
                </div>

                <button class="login-btn" id="submitRsvpBtn">
                    <i class="fas fa-paper-plane"></i> Submit RSVP & View Registry
                </button>
                <button class="back-btn" onclick="registryApp.goToStep(2)">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
            </div>

            <!-- Already RSVPed Message (shown instead of step 3 if already done) -->
            <div class="auth-step-content" id="alreadyRsvpedContent" style="display: none;">
                <div class="already-rsvped">
                    <i class="fas fa-check-circle"></i>
                    <h3>You've already RSVPed!</h3>
                    <p id="existingRsvpStatus">Thanks for letting us know.</p>
                </div>
                <button class="login-btn" id="continueToRegistryBtn">
                    <i class="fas fa-gift"></i> Continue to Registry
                </button>
            </div>
        </div>
    </div>

    <!-- Main Wedding Website (Hidden initially) -->
    <div id="mainWebsite" class="hidden">
        <!-- Fixed Navigation -->
        <nav class="fixed-nav" id="fixedNav">
            <div class="nav-container">
                <div class="nav-logo">Samuel & Beatrice</div>
                <ul class="nav-links">
                    <li><a href="#hero">Home</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="#schedule">Schedule</a></li>
                    <li><a href="#faq">FAQ</a></li>
                    <li><a href="#registry">Registry</a></li>
                    <li><a href="#gallery">Gallery</a></li>
                </ul>
                <button class="logout-nav-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero-section" id="hero">
            <div class="hero-background"></div>
            <div class="botanical-corner botanical-top-left"></div>
            <div class="botanical-corner botanical-bottom-right"></div>
            <div class="hero-content">
                <h1>Samuel & Beatrice</h1>
                <p class="subtitle">Wedding Registry</p>

                <!-- Countdown Timer -->
                <div class="countdown-timer" id="countdownTimer">
                    <div class="countdown-grid">
                        <div class="countdown-item">
                            <span class="countdown-number" id="days">0</span>
                            <span class="countdown-label">Days</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="hours">0</span>
                            <span class="countdown-label">Hours</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="minutes">0</span>
                            <span class="countdown-label">Minutes</span>
                        </div>
                        <div class="countdown-item">
                            <span class="countdown-number" id="seconds">0</span>
                            <span class="countdown-label">Seconds</span>
                        </div>
                    </div>
                </div>

                <!-- RSVP Status (personal) -->
                <div class="rsvp-stats-hero" id="rsvpStatsHero" style="display: none;">
                    <span class="rsvp-status-text" id="rsvpStatusText">RSVP Pending</span>
                </div>

                <!-- RSVP Button -->
                <button class="hero-rsvp-btn" onclick="weddingEnhancements.openRSVP()">
                    <i class="fas fa-envelope"></i> RSVP Now
                </button>
            </div>
            <div class="scroll-indicator" onclick="document.getElementById('about').scrollIntoView({behavior: 'smooth'})">
                <i class="fas fa-chevron-down"></i>
            </div>
        </section>

        <!-- About Section -->
        <section id="about">
            <div class="section-container">
                <h2 class="section-title" data-content="about_title">Our Love Story</h2>
                <div class="about-content-grid">
                    <div class="about-text">
                        <p data-content="about_text_1">
                            We are thrilled to share this special moment with you! Samuel and Beatrice are excited to begin their journey together as husband and wife, and we couldn't imagine celebrating without our closest family and friends.
                        </p>
                    </div>
                    <div class="wedding-details-grid">
                        <div class="detail-card">
                            <i class="fas fa-calendar-heart"></i>
                            <h3>Wedding Date</h3>
                            <p>Saturday, March 14th 2026</p>
                        </div>
                        <div class="detail-card">
                            <i class="fas fa-map-marker-alt"></i>
                            <h3>Venue</h3>
                            <p>Vines Club, Yaldhurst<br><small>651 Pound Rd</small></p>
                        </div>
                        <div class="detail-card">
                            <i class="fas fa-heart"></i>
                            <h3>Our Love</h3>
                            <p>A journey that grows stronger every day</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Schedule Section -->
        <section id="schedule">
            <div class="section-container">
                <h2 class="section-title" data-content="schedule_title">Wedding Day Schedule</h2>
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M18 12.22V9l-5-2.5V5h1V3h-4v2h1v1.5L6 9v3.22L2 14v8h8v-3c0-1.1.9-2 2-2s2 .9 2 2v3h8v-8l-4-1.78zM12 13c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <h3 data-content="schedule_ceremony_title">Ceremony</h3>
                            <div class="timeline-time"><i class="far fa-clock"></i> <span data-content="schedule_ceremony_time">2:00 PM</span></div>
                            <p data-content="schedule_ceremony_desc">Join us as we exchange our vows and begin our journey together. The ceremony will be held in a beautiful outdoor setting.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M20 3H4v10c0 2.21 1.79 4 4 4h6c2.21 0 4-1.79 4-4v-3h2c1.11 0 2-.89 2-2V5c0-1.11-.89-2-2-2zm0 5h-2V5h2v3zM4 19h16v2H4z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <h3 data-content="schedule_cocktail_title">Cocktail Hour</h3>
                            <div class="timeline-time"><i class="far fa-clock"></i> <span data-content="schedule_cocktail_time">3:30 PM</span></div>
                            <p data-content="schedule_cocktail_desc">Enjoy drinks and hors d'oeuvres while we take photos. Mingle with other guests and celebrate!</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <h3 data-content="schedule_reception_title">Reception</h3>
                            <div class="timeline-time"><i class="far fa-clock"></i> <span data-content="schedule_reception_time">5:00 PM</span></div>
                            <p data-content="schedule_reception_desc">Dinner, speeches, and celebration! We'll share our first dance and cut the cake together.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <h3 data-content="schedule_dancing_title">Dancing & Party</h3>
                            <div class="timeline-time"><i class="far fa-clock"></i> <span data-content="schedule_dancing_time">7:00 PM</span></div>
                            <p data-content="schedule_dancing_desc">Let's dance the night away! The dance floor will be open and the party continues late into the evening.</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div class="timeline-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <h3 data-content="schedule_end_title">End of Celebration</h3>
                            <div class="timeline-time"><i class="far fa-clock"></i> <span data-content="schedule_end_time">10:00 PM</span></div>
                            <p data-content="schedule_end_desc">Thank you for celebrating with us! We hope you have a wonderful evening and a safe journey home.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Accommodation & Travel Section - HIDDEN -->
        <section id="accommodation" style="display: none;">
            <div class="section-container">
                <h2 class="section-title"><i class="fas fa-hotel"></i> <span data-content="accommodation_title">Accommodation & Travel</span></h2>

                <div class="intro">
                    <p data-content="accommodation_intro">We want to make sure you have a comfortable stay! Here are some accommodation options near our venue.</p>
                </div>

                <div class="accommodation-grid">
                    <div class="accommodation-card">
                        <div class="accommodation-icon">
                            <i class="fas fa-hotel"></i>
                        </div>
                        <h3>Recommended Hotels</h3>
                        <div class="hotel-list">
                            <div class="hotel-item">
                                <h4>Coming Soon</h4>
                                <p><i class="fas fa-map-marker-alt"></i> Details will be added closer to the date</p>
                            </div>
                        </div>
                    </div>

                    <div class="accommodation-card">
                        <div class="accommodation-icon">
                            <i class="fas fa-plane"></i>
                        </div>
                        <h3>Getting There</h3>
                        <div class="travel-info">
                            <p><strong><i class="fas fa-plane-arrival"></i> Nearest Airport:</strong><br>Christchurch International Airport (CHC)</p>
                            <p><strong><i class="fas fa-car"></i> From Airport:</strong><br>Approximately 20-30 minutes drive to city center</p>
                            <p><strong><i class="fas fa-taxi"></i> Transport Options:</strong><br>Rental cars, taxis, and rideshare services available</p>
                        </div>
                    </div>

                    <div class="accommodation-card">
                        <div class="accommodation-icon">
                            <i class="fas fa-parking"></i>
                        </div>
                        <h3>Parking</h3>
                        <div class="parking-info">
                            <p><strong>Venue Parking:</strong></p>
                            <p><i class="fas fa-info-circle"></i> TBC - Details coming soon</p>
                            <p style="margin-top: 1rem;"><em>We recommend carpooling when possible!</em></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FAQ Section -->
        <section id="faq">
            <div class="section-container">
                <h2 class="section-title" data-content="faq_title"><i class="fas fa-question-circle"></i> Frequently Asked Questions</h2>

                <div class="intro">
                    <p>Got questions? We've got answers! Here's everything you need to know about our big day.</p>
                </div>

                <div class="faq-container">
                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-calendar-check"></i> When is the RSVP deadline?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>Please RSVP by <strong>February 14th</strong>, so we can have an accurate headcount for catering and seating arrangements.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-user-plus"></i> Can I bring a date?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>If your date doesn't have an invite, they ain't invited. We've carefully planned our guest list based on venue capacity.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-child"></i> Are kids welcome?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>As much as we love your little ones, we will not be including them in the ceremony or reception. This is an adults-only celebration. Please reach out if you have questions!</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-cloud-sun"></i> What will the weather be like?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>It is Canterbury in Summer, so expect it to be <strong>warm and potentially windy</strong>. We recommend bringing sunscreen and a light jacket for the evening!</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-parking"></i> Where should I park?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p><strong>TBC</strong> - Parking details will be updated closer to the wedding date. We'll send out information with directions and parking options.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-tshirt"></i> What should I wear?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p><strong>Semiformal.</strong> This is typically an outfit that is dressier than what you'd wear to the office, but not as dressy as a formal evening gown or tuxedo.</p>
                            <p style="margin-top: 0.5rem;"><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> <strong>Ladies:</strong> We advise not wearing stilettos as the ceremony will be on grass.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-home"></i> Is the wedding indoors or outdoors?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>If the weather permits, we hope to have our <strong>ceremony outdoors</strong>, and the <strong>reception will be indoors</strong>.</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-camera"></i> Is it okay to take pictures with our phones and cameras during the wedding?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p><strong>Please refrain from taking photos during the ceremony.</strong> We have a professional photographer capturing every moment.</p>
                            <p style="margin-top: 0.5rem;"><i class="fas fa-ban" style="color: var(--error);"></i> <strong>Important:</strong> We do not want any photos posted to social media before we make a post. Let us share the first photos!</p>
                        </div>
                    </div>

                    <div class="faq-item">
                        <div class="faq-question" onclick="toggleFAQ(this)">
                            <h3><i class="fas fa-phone"></i> Whom should I call with questions?</h3>
                            <i class="fas fa-chevron-down faq-icon"></i>
                        </div>
                        <div class="faq-answer">
                            <p>If you have any questions, please reach out to:</p>
                            <p style="margin-top: 0.5rem;"><i class="fas fa-user"></i> <strong>Samuel:</strong> <a href="tel:02040848631">020 4084 8631</a></p>
                            <p><i class="fas fa-user"></i> <strong>Beatrice:</strong> <a href="tel:0276561200">027 656 1200</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Registry Section -->
        <section id="registry">
            <div class="section-container">
                <h2 class="section-title" data-content="registry_title">Wedding Registry</h2>

                <div class="intro">
                    <p data-content="registry_description">Thank you for being part of our special day! Instead of traditional gifts, we've created this registry where you can contribute towards items that will help us build our new home together. Every contribution, no matter the size, means the world to us and brings us one step closer to our dreams. </p>
                </div>

                <!-- Statistics Section -->
                <div class="stats-section">
                    <div class="stats-grid" id="statsGrid">
                        <!-- Stats will be loaded here -->
                    </div>
                </div>

                <!-- Search and Filter Controls -->
                <div class="controls">
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchInput" placeholder="Search for gifts...">
                    </div>
                    <div class="filter-buttons">
                        <div class="filter-row">
                            <button class="filter-btn active" data-filter="all">
                                <i class="fas fa-list"></i> All Items
                            </button>
                            <button class="filter-btn" data-filter="favorites">
                                <i class="fas fa-star"></i> My Favorites
                            </button>
                        </div>
                        <div class="filter-row">
                            <button class="filter-btn" data-filter="home">
                                <i class="fas fa-home"></i> Home
                            </button>
                            <button class="filter-btn" data-filter="kitchen">
                                <i class="fas fa-utensils"></i> Kitchen
                            </button>
                            <button class="filter-btn" data-filter="experiences">
                                <i class="fas fa-heart"></i> Experiences
                            </button>
                            <button class="filter-btn" data-filter="completed">
                                <i class="fas fa-check-circle"></i> Completed
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Featured Items Section -->
                <div class="featured-items">
                    <h3><i class="fas fa-star"></i> Featured Items</h3>
                    <div id="featuredItemsGrid" class="registry-grid"></div>
                </div>

                <!-- Almost Funded Section -->
                <div class="almost-funded">
                    <h3><i class="fas fa-fire"></i> Almost There!</h3>
                    <div id="almostFundedGrid" class="registry-grid"></div>
                </div>

                <div id="registryGrid" class="registry-grid">
                    <!-- Skeleton loaders - shown while loading -->
                    <div class="skeleton-card registry-skeleton">
                        <div class="skeleton skeleton-image"></div>
                        <div class="skeleton-card-content">
                            <div class="skeleton skeleton-text" style="width: 70%;"></div>
                            <div class="skeleton skeleton-text short" style="width: 40%;"></div>
                            <div class="skeleton skeleton-text" style="width: 90%; height: 0.5rem;"></div>
                            <div class="skeleton skeleton-text" style="width: 60%; margin-top: 1rem;"></div>
                        </div>
                    </div>
                    <div class="skeleton-card registry-skeleton">
                        <div class="skeleton skeleton-image"></div>
                        <div class="skeleton-card-content">
                            <div class="skeleton skeleton-text" style="width: 80%;"></div>
                            <div class="skeleton skeleton-text short" style="width: 50%;"></div>
                            <div class="skeleton skeleton-text" style="width: 85%; height: 0.5rem;"></div>
                            <div class="skeleton skeleton-text" style="width: 55%; margin-top: 1rem;"></div>
                        </div>
                    </div>
                    <div class="skeleton-card registry-skeleton">
                        <div class="skeleton skeleton-image"></div>
                        <div class="skeleton-card-content">
                            <div class="skeleton skeleton-text" style="width: 65%;"></div>
                            <div class="skeleton skeleton-text short" style="width: 45%;"></div>
                            <div class="skeleton skeleton-text" style="width: 95%; height: 0.5rem;"></div>
                            <div class="skeleton skeleton-text" style="width: 50%; margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Photo Gallery Section -->
        <section id="gallery">
            <div class="section-container">
                <h2 class="section-title" data-content="gallery_title">Our Photo Gallery</h2>

                <!-- Gallery Locked Message (shown before wedding) -->
                <div id="galleryLockedMessage" style="display: none; text-align: center; padding: 4rem 2rem; background: var(--cream); border-radius: var(--radius-lg); margin: 2rem 0;">
                    <i class="fas fa-lock" style="font-size: 4rem; color: var(--navy); opacity: 0.3; margin-bottom: 1.5rem; display: block;"></i>
                    <h3 style="color: var(--navy); font-size: 1.5rem; margin-bottom: 1rem;">Gallery Opens After The Wedding</h3>
                    <p style="color: var(--light-navy); font-size: 1.1rem; max-width: 600px; margin: 0 auto;">
                        The photo gallery will be available after our special day on <strong>March 14th, 2026</strong>.
                    </p>
                    <p style="color: var(--light-navy); font-size: 0.95rem; margin-top: 1rem; opacity: 0.8;">
                        We can't wait to share the memories with you!
                    </p>
                </div>

                <!-- Gallery Content (shown after wedding) -->
                <div id="galleryContent" style="display: none;">
                    <!-- Photo Upload Section -->
                    <div style="text-align: center; padding: 2rem; margin-bottom: 2rem;">
                        <button class="upload-btn" onclick="document.getElementById('photoUpload').click()">
                            <i class="fas fa-camera"></i> <span data-content="gallery_upload_btn">Share Your Photos</span>
                        </button>
                        <input type="file" id="photoUpload" style="display:none" accept="image/*" onchange="weddingEnhancements.handlePhotoUpload(event)">
                        <p style="color: var(--botanical-blue); font-size: 0.9rem; margin-top: 0.75rem;" data-content="gallery_upload_desc">Help us capture memories from the celebration</p>
                        <p style="color: var(--light-navy); font-size: 0.8rem; margin-top: 0.25rem; opacity: 0.7;">
                            <i class="fas fa-magic"></i> <span data-content="gallery_upload_info">Photos are automatically optimized for fast uploads</span>
                        </p>
                    </div>

                    <!-- Gallery Grid -->
                    <div id="galleryPhotosGrid" class="gallery-grid">
                        <!-- Skeleton loaders for gallery -->
                        <div class="skeleton gallery-skeleton" style="aspect-ratio: 1; border-radius: 12px;"></div>
                        <div class="skeleton gallery-skeleton" style="aspect-ratio: 1; border-radius: 12px;"></div>
                        <div class="skeleton gallery-skeleton" style="aspect-ratio: 1; border-radius: 12px;"></div>
                        <div class="skeleton gallery-skeleton" style="aspect-ratio: 1; border-radius: 12px;"></div>
                    </div>

                    <div id="galleryPlaceholder" style="text-align: center; padding: 3rem 2rem; display: none;">
                        <i class="fas fa-camera" style="font-size: 3.5rem; color: var(--botanical-blue); opacity: 0.4; margin-bottom: 1rem; display: block;"></i>
                        <p style="color: var(--light-navy); font-size: 1rem;" data-content="gallery_placeholder">
                            No photos yet. Be the first to share!
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p data-content="footer_message">Thank you for celebrating with us!</p>
            <p data-content="footer_names">Samuel & Beatrice </p>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 1rem;" data-content="footer_copyright">
                Made with love |  2026
            </p>
        </footer>
    </div>

    <!-- Payment Modal -->
    <div id="paymentModal" class="payment-modal">
        <div class="payment-modal-content">
            <div class="payment-modal-header">
                <h3>Complete Your Contribution</h3>
                <p>Secure payment powered by Stripe</p>
            </div>
            <div class="payment-modal-body">
                <div class="payment-amount" id="paymentAmount">
                    Contributing $0.00 to Item Name
                </div>

                <form id="payment-form">
                    <div class="form-field">
                        <div id="payment-element">
                            <!-- Stripe Payment Element will be inserted here -->
                        </div>
                        <div id="payment-errors" role="alert"></div>
                    </div>

                    <div class="secure-badge">
                        <i class="fas fa-lock"></i>
                        <span>Your payment is secure and encrypted</span>
                    </div>

                    <div class="payment-buttons">
                        <button type="button" class="payment-btn secondary" onclick="registryApp.closePaymentModal()">
                            Cancel
                        </button>
                        <button type="submit" class="payment-btn primary" id="submit-payment">
                            <i class="fas fa-heart"></i> Pay Now
                        </button>
                    </div>

                    <div id="payment-message" class="payment-message"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Thank You Modal -->
    <div id="thankYouModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div style="text-align: center;">
                <i class="fas fa-heart" style="font-size: 3rem; color: var(--gold); margin-bottom: 1rem;"></i>
                <h2 style="color: var(--navy); margin-bottom: 1rem;">Thank You! </h2>
                <p id="thankYouMessage" style="font-size: 1.1rem; color: var(--light-navy);"></p>
            </div>
        </div>
    </div>

    <!-- Bought In Store Confirmation Modal -->
    <div id="boughtInStoreModal" class="payment-modal">
        <div class="payment-modal-content" style="max-width: 400px;">
            <div class="payment-modal-header" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                <h3><i class="fas fa-shopping-bag"></i> Confirm Purchase</h3>
                <p>Mark this item as bought in store</p>
            </div>
            <div class="payment-modal-body" style="padding: 1.5rem;">
                <div style="text-align: center; margin-bottom: 1.5rem;">
                    <p id="boughtInStoreItemName" style="font-size: 1.1rem; font-weight: 600; color: var(--navy); margin-bottom: 0.5rem;"></p>
                    <p id="boughtInStorePrice" style="font-size: 1.5rem; font-weight: 700; color: var(--gold);"></p>
                </div>
                <!-- Gift Card Voucher Selection (hidden by default) -->
                <div id="giftCardVoucherSection" style="display: none; margin-bottom: 1.5rem;">
                    <p style="text-align: center; color: var(--navy); font-weight: 600; margin-bottom: 0.75rem;">How many vouchers did you buy?</p>
                    <div style="display: flex; justify-content: center; gap: 0.5rem; flex-wrap: wrap;">
                        <button type="button" class="voucher-select-btn" data-vouchers="1" style="padding: 0.5rem 1rem; border: 2px solid var(--gold); background: white; border-radius: 8px; font-weight: 600; cursor: pointer;">1 ($50)</button>
                        <button type="button" class="voucher-select-btn" data-vouchers="2" style="padding: 0.5rem 1rem; border: 2px solid var(--gold); background: white; border-radius: 8px; font-weight: 600; cursor: pointer;">2 ($100)</button>
                        <button type="button" class="voucher-select-btn" data-vouchers="3" style="padding: 0.5rem 1rem; border: 2px solid var(--gold); background: white; border-radius: 8px; font-weight: 600; cursor: pointer;">3 ($150)</button>
                        <button type="button" class="voucher-select-btn" data-vouchers="4" style="padding: 0.5rem 1rem; border: 2px solid var(--gold); background: white; border-radius: 8px; font-weight: 600; cursor: pointer;">4 ($200)</button>
                        <button type="button" class="voucher-select-btn" data-vouchers="5" style="padding: 0.5rem 1rem; border: 2px solid var(--gold); background: white; border-radius: 8px; font-weight: 600; cursor: pointer;">5 ($250)</button>
                    </div>
                    <p id="selectedVoucherAmount" style="text-align: center; color: var(--gold); font-weight: 700; margin-top: 0.75rem; font-size: 1.2rem;"></p>
                </div>
                <p style="text-align: center; color: var(--light-navy); font-size: 0.9rem; margin-bottom: 1.5rem;">
                    By confirming, you're letting Sam & Beatrice know you've purchased this gift for them.
                </p>
                <div class="payment-buttons">
                    <button type="button" class="payment-btn secondary" onclick="registryApp.closeBoughtInStoreModal()">
                        Cancel
                    </button>
                    <button type="button" class="payment-btn primary" id="confirmBoughtInStore" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                        <i class="fas fa-check"></i> Yes, I bought this
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- RSVP Modal -->
    <div id="rsvpModal" class="modal">
        <div class="modal-content rsvp-modal-content">
            <span class="close" onclick="weddingEnhancements.closeRSVP()">&times;</span>
            <div class="modal-header">
                <i class="fas fa-envelope-open-text"></i>
                <h2>RSVP to Our Wedding</h2>
                <p class="modal-subtitle">Saturday, March 14th 2026  Christchurch, New Zealand</p>
            </div>
            <form id="rsvpForm" onsubmit="weddingEnhancements.submitRSVP(event)">
                <div class="form-row">
                    <div class="form-field">
                        <label><i class="fas fa-user"></i> Full Name *</label>
                        <input type="text" required id="rsvpName" placeholder="Enter your full name">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label><i class="fas fa-envelope"></i> Email</label>
                        <input type="email" id="rsvpEmail" placeholder="your.email@example.com">
                    </div>
                    <div class="form-field">
                        <label><i class="fas fa-phone"></i> Phone</label>
                        <input type="tel" id="rsvpPhone" placeholder="021 123 4567">
                    </div>
                </div>
                <div class="form-field">
                    <label><i class="fas fa-check-circle"></i> Will you attend? *</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="attending" required id="rsvpAttending" value="yes">
                            <span class="radio-label">
                                <i class="fas fa-heart"></i>
                                <strong>Yes, I'll be there!</strong>
                                <small>Can't wait to celebrate</small>
                            </span>
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="attending" value="no">
                            <span class="radio-label">
                                <i class="fas fa-heart-broken"></i>
                                <strong>Sorry, I can't make it</strong>
                                <small>Wish I could be there</small>
                            </span>
                        </label>
                    </div>
                </div>
                <div class="form-field">
                    <label><i class="fas fa-utensils"></i> Dietary Restrictions</label>
                    <textarea id="rsvpDietary" rows="2" placeholder="Any allergies or dietary requirements?"></textarea>
                </div>
                <div class="form-field">
                    <label><i class="fas fa-comment"></i> Message to the Couple</label>
                    <textarea id="rsvpMessage" rows="3" placeholder="Share your well wishes or any special requests..."></textarea>
                </div>
                <button type="submit" class="btn btn-success btn-large">
                    <i class="fas fa-paper-plane"></i> Submit RSVP
                </button>
            </form>
        </div>
    </div>

    <!-- Guest Book Modal -->
    <div id="guestBookModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="weddingEnhancements.closeGuestBook()">&times;</span>
            <h2>Guest Book</h2>
            <div id="guestBookEntries"></div>
            <form id="guestBookForm" onsubmit="weddingEnhancements.submitGuestBookEntry(event)">
                <div class="form-field">
                    <label>Your Name</label>
                    <input type="text" required id="gbName">
                </div>
                <div class="form-field">
                    <label>Your Message</label>
                    <textarea required id="gbMessage" rows="4" placeholder="Share your wishes for the happy couple..."></textarea>
                </div>
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-paper-plane"></i> Post Message
                </button>
            </form>
        </div>
    </div>

    <!-- Photo Modal -->
    <div id="photoModal" class="modal">
        <div class="modal-content" style="background: transparent; border: none; box-shadow: none; max-width: 90vw;">
            <span class="close" onclick="weddingEnhancements.closePhotoModal()" style="color: white; font-size: 3rem;">&times;</span>
            <img id="modalPhoto" src="" style="width: 100%; height: auto; border-radius: 10px;">
        </div>
    </div>

    <!-- Mobile Bottom Navigation - Glassmorphic with SVG Icons (Order matches page scroll) -->
    <nav class="mobile-bottom-nav" role="navigation" aria-label="Mobile navigation">
        <a href="#hero" class="nav-item active" aria-label="Go to home section">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            <span>Home</span>
        </a>
        <a href="#faq" class="nav-item" aria-label="Frequently asked questions">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
            </svg>
            <span>FAQ</span>
        </a>
        <a href="#registry" class="nav-item" aria-label="View gift registry">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
            </svg>
            <span>Gifts</span>
        </a>
        <a href="#gallery" class="nav-item" aria-label="View photo gallery">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <circle cx="12" cy="12" r="3.2"/>
                <path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/>
            </svg>
            <span>Photos</span>
        </a>
        <a href="#" class="nav-item" id="mobileRsvpBtn" onclick="weddingEnhancements.openRSVP(); return false;" aria-label="Open RSVP form">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
            </svg>
            <span>RSVP</span>
        </a>
    </nav>

    </div>

    <script>
        // Global registry app instance
        let registryApp;

        class WeddingWebsite {
            constructor() {
                this.items = [];
                this.filteredItems = [];
                this.currentFilter = 'all';
                this.currentSearch = '';
                this.stripe = null;
                this.cardElement = null;
                this.currentPaymentData = null;
                this.currentGuest = null;
                this.qrScanner = null;
                this.siteContent = {};
                this.favorites = this.loadFavorites();

                console.log(' Wedding Website initializing...');
                this.init();
            }

            // Favorites Management
            loadFavorites() {
                try {
                    const stored = localStorage.getItem('weddingRegistryFavorites');
                    return stored ? JSON.parse(stored) : [];
                } catch (e) {
                    console.error('Error loading favorites:', e);
                    return [];
                }
            }

            saveFavorites() {
                try {
                    localStorage.setItem('weddingRegistryFavorites', JSON.stringify(this.favorites));
                    this.updateFavoritesCount();
                } catch (e) {
                    console.error('Error saving favorites:', e);
                }
            }

            toggleFavorite(itemId) {
                const index = this.favorites.indexOf(itemId);

                if (index === -1) {
                    this.favorites.push(itemId);
                    this.showToast('Added to your list!', 'success');
                } else {
                    this.favorites.splice(index, 1);
                    this.showToast('Removed from your list', 'info');
                }
                this.saveFavorites();

                // Update button state
                const btn = document.querySelector(`.favorite-btn[data-item-id="${itemId}"]`);
                if (btn) {
                    btn.classList.toggle('active', this.favorites.includes(itemId));
                    btn.querySelector('i').className = this.favorites.includes(itemId)
                        ? 'fas fa-star' : 'far fa-star';
                }

                // Re-render if on favorites filter
                if (this.currentFilter === 'favorites') {
                    this.filterItems();
                }
            }

            isFavorite(itemId) {
                return this.favorites.includes(itemId);
            }

            updateFavoritesCount() {
                const favBtn = document.querySelector('[data-filter="favorites"]');
                if (favBtn) {
                    let badge = favBtn.querySelector('.favorites-count');
                    if (this.favorites.length > 0) {
                        if (!badge) {
                            badge = document.createElement('span');
                            badge.className = 'favorites-count';
                            favBtn.appendChild(badge);
                        }
                        badge.textContent = this.favorites.length;
                    } else if (badge) {
                        badge.remove();
                    }
                }
            }

            async init() {
                console.log(' Setting up website...');
                await this.loadSiteContent();
                await this.checkGuestSession();
                this.setupLoginEventListeners();
                this.setupScrollEffects();
                console.log(' Website initialization complete');
            }

            async loadSiteContent() {
                try {
                    console.log(' Loading site content from API...');
                    const response = await fetch('/api/content');
                    if (response.ok) {
                        this.siteContent = await response.json();
                        console.log(' Site content loaded successfully');
                        this.applySiteContent();
                    } else {
                        console.warn(' Failed to load site content, using defaults');
                    }
                } catch (error) {
                    console.error(' Error loading site content:', error);
                }
            }

            applySiteContent() {
                // Apply content to elements with data-content attributes
                document.querySelectorAll('[data-content]').forEach(element => {
                    const key = element.getAttribute('data-content');
                    const content = this.getContent(key);
                    if (content) {
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.value = content;
                        } else {
                            // Check if element has child icons or other HTML we want to preserve
                            const icon = element.querySelector('i.fas, i.far');
                            if (icon) {
                                // Preserve the icon and update only the text
                                const textNodes = Array.from(element.childNodes).filter(node => node.nodeType === Node.TEXT_NODE);
                                if (textNodes.length > 0) {
                                    textNodes[0].textContent = ' ' + content;
                                } else {
                                    element.appendChild(document.createTextNode(' ' + content));
                                }
                            } else {
                                element.textContent = content;
                            }
                        }
                    }
                });
                console.log(' Site content applied to page');
            }

            getContent(key, defaultValue = '') {
                return this.siteContent[key]?.value || defaultValue;
            }

            setupScrollEffects() {
                // Show/hide fixed navigation on scroll
                let lastScroll = 0;
                window.addEventListener('scroll', () => {
                    const currentScroll = window.pageYOffset;
                    const nav = document.getElementById('fixedNav');

                    if (currentScroll > 100) {
                        nav.classList.add('visible');
                    } else {
                        nav.classList.remove('visible');
                    }

                    lastScroll = currentScroll;
                });

                // Smooth scroll for navigation links
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function (e) {
                        e.preventDefault();
                        const target = document.querySelector(this.getAttribute('href'));
                        if (target) {
                            target.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }
                    });
                });
            }

            async checkGuestSession() {
                // Check if guest is already logged in
                const guestData = sessionStorage.getItem('weddingRegistryGuest');
                if (guestData) {
                    try {
                        this.currentGuest = JSON.parse(guestData);
                        // Restore guest info for status display
                        const guestInfo = sessionStorage.getItem('weddingGuestInfo');
                        if (guestInfo) {
                            window.currentGuestInfo = JSON.parse(guestInfo);
                        }
                        console.log(' Found existing guest session:', this.currentGuest.name);
                        await this.showMainWebsite();
                    } catch (error) {
                        console.error('Error parsing guest data:', error);
                        this.showLoginScreen();
                    }
                } else {
                    // Check if URL has password parameter (from QR code)
                    const urlParams = new URLSearchParams(window.location.search);
                    const passwordFromUrl = urlParams.get('password');

                    if (passwordFromUrl) {
                        console.log(' Password found in URL from QR code');
                        await this.loginWithGuestCode(passwordFromUrl);
                        // Clean up URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    } else {
                        this.showLoginScreen();
                    }
                }
            }

            showLoginScreen() {
                console.log(' Showing login screen');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('mainWebsite').classList.add('hidden');
                this.selectLoginOption('code');
            }

            async showMainWebsite() {
                console.log(' Showing main website');
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainWebsite').classList.remove('hidden');
                document.body.classList.add('main-visible');

                await this.initializeStripe();
                await this.loadItems();
                this.updateDynamicContent();
                this.setupEventListeners();
                this.updateStats();
                this.initLazyLoading();
                this.loadRsvpStats(); // Load RSVP stats for hero
            }

            // Update RSVP status display for current guest
            loadRsvpStats() {
                const statsSection = document.getElementById('rsvpStatsHero');
                const statusText = document.getElementById('rsvpStatusText');
                const guestInfo = window.currentGuestInfo;

                if (!statsSection || !statusText) return;

                if (guestInfo && guestInfo.guest) {
                    statsSection.style.display = 'block';
                    if (guestInfo.guest.hasRsvped) {
                        if (guestInfo.guest.rsvpResponse === 'yes') {
                            statusText.textContent = 'Attending';
                            statusText.style.color = '#4ade80';
                        } else {
                            statusText.textContent = 'Not Attending';
                            statusText.style.color = '#f87171';
                        }
                    } else {
                        statusText.textContent = 'RSVP Pending';
                        statusText.style.color = '#fbbf24';
                    }
                } else {
                    statsSection.style.display = 'none';
                }
            }

            updateDynamicContent() {
                console.log(' Updating dynamic content from database...');

                // Since index.html is large and complex, we update content via innerHTML replacements
                // This is a simple implementation - for full functionality, admin can edit content in database

                // Update FAQ section
                this.updateFAQSection();

                // Update other sections as needed
                // Note: Hero section, About, Schedule use hardcoded HTML for design integrity
                // Admin can edit the content in database, and it will be reflected here on next load

                console.log(' Dynamic content updated - FAQ section refreshed');
            }

            updateFAQSection() {
                // Update FAQ items dynamically
                const faqContainer = document.querySelector('#faq .faq-container');
                if (!faqContainer || !this.siteContent) return;

                const faqQuestions = [
                    { q: 'faq_rsvp_q', a: 'faq_rsvp_a' },
                    { q: 'faq_attire_q', a: 'faq_attire_a' },
                    { q: 'faq_kids_q', a: 'faq_kids_a' },
                    { q: 'faq_diet_q', a: 'faq_diet_a' },
                    { q: 'faq_plus_q', a: 'faq_plus_a' },
                    { q: 'faq_photos_q', a: 'faq_photos_a' },
                    { q: 'faq_gifts_q', a: 'faq_gifts_a' },
                    { q: 'faq_contact_q', a: 'faq_contact_a' },
                    { q: 'faq_dance_q', a: 'faq_dance_a' }
                ];

                let faqHTML = '';
                faqQuestions.forEach((faq, index) => {
                    const question = this.getContent(faq.q, '');
                    const answer = this.getContent(faq.a, '');

                    if (question && answer) {
                        faqHTML += `
                            <div class="faq-item">
                                <div class="faq-question" onclick="toggleFAQ(this)">
                                    <h3><i class="fas fa-${this.getFAQIcon(index)}"></i> ${question}</h3>
                                    <i class="fas fa-chevron-down faq-icon"></i>
                                </div>
                                <div class="faq-answer">
                                    <p>${answer}</p>
                                </div>
                            </div>
                        `;
                    }
                });

                if (faqHTML) {
                    faqContainer.innerHTML = faqHTML;
                }
            }

            getFAQIcon(index) {
                const icons = ['calendar-check', 'tshirt', 'child', 'utensils', 'user-plus', 'camera', 'gift', 'envelope', 'music'];
                return icons[index] || 'question-circle';
            }

            setupLoginEventListeners() {
                console.log(' Setting up login event listeners');

                const codeOption = document.getElementById('codeOption');
                const qrOption = document.getElementById('qrOption');

                if (codeOption) {
                    codeOption.onclick = () => {
                        console.log(' Code option clicked');
                        this.selectLoginOption('code');
                    };
                }

                if (qrOption) {
                    qrOption.onclick = () => {
                        console.log(' QR option clicked');
                        this.selectLoginOption('qr');
                    };
                }

                // Multi-step auth flow
                this.authStep = 1;
                this.pendingGuest = null;
                this.familyMembers = [];

                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.onclick = async () => {
                        console.log(' Step 1: Password verification');
                        const password = document.getElementById('guestCode').value.trim();
                        if (password) {
                            await this.verifyPassword(password);
                        } else {
                            this.showToast('Please enter the password', 'error');
                        }
                    };
                }

                const guestCodeInput = document.getElementById('guestCode');
                if (guestCodeInput) {
                    guestCodeInput.addEventListener('keypress', async (e) => {
                        if (e.key === 'Enter') {
                            const password = e.target.value.trim();
                            if (password) {
                                await this.verifyPassword(password);
                            }
                        }
                    });
                }

                // Step 2: Find Name button
                const findNameBtn = document.getElementById('findNameBtn');
                if (findNameBtn) {
                    findNameBtn.onclick = async () => {
                        console.log(' Step 2: Looking up guest name');
                        const name = document.getElementById('guestName').value.trim();
                        if (name) {
                            await this.lookupGuestName(name);
                        } else {
                            this.showToast('Please enter your name', 'error');
                        }
                    };
                }

                const guestNameInput = document.getElementById('guestName');
                if (guestNameInput) {
                    guestNameInput.addEventListener('keypress', async (e) => {
                        if (e.key === 'Enter') {
                            const name = e.target.value.trim();
                            if (name) {
                                await this.lookupGuestName(name);
                            }
                        }
                    });
                }

                // Step 3: RSVP submit button
                const submitRsvpBtn = document.getElementById('submitRsvpBtn');
                if (submitRsvpBtn) {
                    submitRsvpBtn.onclick = async () => {
                        console.log(' Step 3: Submitting RSVP');
                        await this.submitRsvp();
                    };
                }

                // Already RSVPed - continue to registry
                const continueBtn = document.getElementById('continueToRegistryBtn');
                if (continueBtn) {
                    continueBtn.onclick = async () => {
                        console.log(' Continuing to registry');
                        await this.completeLogin();
                    };
                }

                // RSVP attending radio change - show/hide dietary
                document.querySelectorAll('input[name="rsvpAttending"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        const detailsDiv = document.getElementById('attendingDetails');
                        if (detailsDiv) {
                            detailsDiv.style.display = e.target.value === 'yes' ? 'block' : 'none';
                        }
                    });
                });

                const closeScanner = document.getElementById('closeScanner');
                if (closeScanner) {
                    closeScanner.onclick = () => {
                        console.log(' Closing QR scanner');
                        this.stopQRScanner();
                    };
                }

                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.onclick = () => {
                        console.log(' Logout clicked');
                        this.logout();
                    };
                }
            }

            selectLoginOption(option) {
                console.log(` Selecting login option: ${option}`);

                // Simplified for universal password - just focus the input
                if (option === 'code') {
                    setTimeout(() => {
                        const input = document.getElementById('guestCode');
                        if (input) input.focus();
                    }, 100);
                }
            }

            async startQRScanner() {
                try {
                    console.log(' Starting QR scanner...');
                    const video = document.getElementById('qr-video');

                    if (typeof QrScanner !== 'undefined') {
                        this.qrScanner = new QrScanner(
                            video,
                            result => this.handleQRResult(result),
                            {
                                onDecodeError: error => {},
                                highlightScanRegion: true,
                                highlightCodeOutline: true,
                            }
                        );

                        await this.qrScanner.start();
                        console.log(' QR Scanner started successfully');
                    } else {
                        throw new Error('QR Scanner library not loaded');
                    }
                } catch (error) {
                    console.error(' Error starting QR scanner:', error);
                    this.showToast('Camera access required for QR scanning. Please use guest code instead.', 'error');
                    this.selectLoginOption('code');
                }
            }

            stopQRScanner() {
                if (this.qrScanner) {
                    this.qrScanner.stop();
                    this.qrScanner.destroy();
                    this.qrScanner = null;
                    console.log(' QR Scanner stopped');
                }
            }

            async handleQRResult(result) {
                console.log(' QR Code detected:', result.data);
                this.stopQRScanner();

                let guestCode = null;

                try {
                    const url = new URL(result.data);
                    const pathMatch = url.pathname.match(/\/guest\/([A-Z0-9]{6,12})/i);
                    if (pathMatch) {
                        guestCode = pathMatch[1];
                    }
                } catch (error) {
                    if (/^[A-Z0-9]{6,12}$/i.test(result.data)) {
                        guestCode = result.data;
                    }
                }

                if (guestCode) {
                    await this.loginWithGuestCode(guestCode);
                } else {
                    this.showToast('Invalid QR code. Please try again or use your guest code.', 'error');
                    this.selectLoginOption('code');
                }
            }

            // ========== MULTI-STEP AUTH FLOW ==========

            // Step 1: Verify password
            async verifyPassword(password) {
                const loginBtn = document.getElementById('loginBtn');
                try {
                    loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Verifying...';
                    loginBtn.disabled = true;

                    const response = await fetch('/api/guest/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ guestCode: password })
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            console.log(' Password verified, moving to step 2');
                            this.goToStep(2);
                            setTimeout(() => {
                                const nameInput = document.getElementById('guestName');
                                if (nameInput) nameInput.focus();
                            }, 100);
                        } else {
                            throw new Error(result.error || 'Invalid password');
                        }
                    } else {
                        const error = await response.json();
                        throw new Error(error.error || 'Invalid password');
                    }
                } catch (error) {
                    console.error(' Password error:', error);
                    this.showToast(error.message || 'Invalid password', 'error');
                    loginBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Continue';
                    loginBtn.disabled = false;
                }
            }

            // Step 2: Look up guest name in guest list
            async lookupGuestName(name) {
                const findBtn = document.getElementById('findNameBtn');
                const errorDiv = document.getElementById('nameLookupError');
                try {
                    findBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Looking up...';
                    findBtn.disabled = true;
                    errorDiv.style.display = 'none';

                    const response = await fetch('/api/guest-list/lookup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ name })
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        console.log(' Guest found:', result.guest.name);
                        this.pendingGuest = result.guest;
                        this.familyMembers = result.familyMembers || [];

                        // Reset button state
                        findBtn.innerHTML = '<i class="fas fa-check"></i> Found!';

                        // Check if anyone in the group still needs to RSVP
                        const hasUnrsvpedMembers = result.familyMembers?.some(m => !m.hasRsvped) || false;
                        const allRsvped = result.guest.hasRsvped && !hasUnrsvpedMembers;

                        if (allRsvped) {
                            // Everyone has RSVPed, skip to registry
                            console.log(' All family members already RSVPed, skipping to registry');
                            setTimeout(() => this.showAlreadyRsvped(result.guest), 300);
                        } else {
                            // Show RSVP form (either main guest or family members need to RSVP)
                            console.log(' Showing RSVP form - main guest or family members need to RSVP');
                            setTimeout(() => this.showRsvpForm(result.guest, result.familyMembers), 300);
                        }
                    } else {
                        // Name not found - deny access
                        throw new Error(result.error || 'Sorry, your name was not found on the guest list. Please check the spelling or contact Sam & Beatrice.');
                    }
                } catch (error) {
                    console.error(' Lookup error:', error);
                    errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${error.message}`;
                    errorDiv.style.display = 'block';
                    findBtn.innerHTML = '<i class="fas fa-search"></i> Find My Name';
                    findBtn.disabled = false;
                }
            }

            // Show RSVP form (step 3)
            showRsvpForm(guest, familyMembers) {
                const greeting = document.getElementById('rsvpGreeting');
                const firstName = guest.name.split(' ')[0];

                // Check if main guest has already RSVPed
                if (guest.hasRsvped) {
                    greeting.innerHTML = `Hi ${firstName}! You've already RSVPed. <span style="color: var(--success); font-weight: bold;">${guest.rsvpResponse === 'yes' ? "You're attending!" : guest.rsvpResponse === 'no' ? "You can't make it." : "You're still deciding."}</span><br><small style="color: var(--light-navy);">You can RSVP for your family members below.</small>`;

                    // Hide main guest RSVP options since they've already responded
                    const mainRsvpOptions = document.querySelector('.rsvp-options');
                    const mainRsvpFields = document.querySelectorAll('#rsvpEmail, #rsvpDietary, #rsvpMessage');
                    if (mainRsvpOptions) mainRsvpOptions.style.display = 'none';
                    mainRsvpFields.forEach(field => {
                        if (field) field.closest('.form-group')?.style.setProperty('display', 'none');
                    });
                } else {
                    greeting.textContent = `Hi ${firstName}! Please let us know if you can make it.`;

                    // Make sure main guest RSVP options are visible
                    const mainRsvpOptions = document.querySelector('.rsvp-options');
                    const mainRsvpFields = document.querySelectorAll('#rsvpEmail, #rsvpDietary, #rsvpMessage');
                    if (mainRsvpOptions) mainRsvpOptions.style.display = 'flex';
                    mainRsvpFields.forEach(field => {
                        if (field) field.closest('.form-group')?.style.removeProperty('display');
                    });
                }

                // Show family members if any (excluding the current guest)
                const familySection = document.getElementById('familyRsvpSection');
                const familyList = document.getElementById('familyMembersList');
                const otherMembers = familyMembers.filter(m => m.id !== guest.id);

                if (otherMembers.length > 0) {
                    familySection.style.display = 'block';
                    familyList.innerHTML = otherMembers.map(member => `
                        <div class="family-member-item ${member.hasRsvped ? 'already-rsvped' : ''}" data-member-id="${member.id}">
                            <div class="family-member-name">
                                <span>${member.name}</span>
                                ${member.hasRsvped ? '<small class="rsvp-status">(Already RSVPed)</small>' : ''}
                            </div>
                            ${!member.hasRsvped ? `
                                <div class="family-member-inputs">
                                    <select class="family-rsvp-select" data-member-id="${member.id}">
                                        <option value="">-- Select --</option>
                                        <option value="yes">Attending</option>
                                        <option value="no">Not attending</option>
                                    </select>
                                    <input type="email" class="family-email-input" data-member-id="${member.id}"
                                           placeholder="Their email (optional)" style="margin-top: 0.5rem; width: 100%; padding: 0.5rem; border: 1px solid var(--beige); border-radius: 6px; font-size: 0.85rem;">
                                </div>
                            ` : `<span class="rsvp-badge">${member.rsvpResponse === 'yes' ? ' Yes' : member.rsvpResponse === 'no' ? ' No' : '? Maybe'}</span>`}
                        </div>
                    `).join('');
                } else {
                    familySection.style.display = 'none';
                }

                this.goToStep(3);
            }

            // Show already RSVPed message
            showAlreadyRsvped(guest) {
                const statusEl = document.getElementById('existingRsvpStatus');
                const responseText = guest.rsvpResponse === 'yes' ? "You're attending!" :
                                    guest.rsvpResponse === 'no' ? "You can't make it." : "You're still deciding.";
                statusEl.textContent = responseText;

                // Store the RSVP response for completeLogin
                this.lastRsvpResponse = guest.rsvpResponse;

                // Hide step 2 content
                document.getElementById('step2Content').classList.remove('active');

                // Hide step 3 content
                document.getElementById('step3Content').classList.remove('active');

                // Show already RSVPed content
                document.getElementById('alreadyRsvpedContent').style.display = 'block';
                document.getElementById('alreadyRsvpedContent').classList.add('active');

                // Update step indicator to show step 3
                this.updateStepIndicator(3);

                // Reset the find button for next time
                const findBtn = document.getElementById('findNameBtn');
                if (findBtn) {
                    findBtn.innerHTML = '<i class="fas fa-search"></i> Find My Name';
                    findBtn.disabled = false;
                }
            }

            // Step 3: Submit RSVP
            async submitRsvp() {
                const submitBtn = document.getElementById('submitRsvpBtn');
                const selectedAttending = document.querySelector('input[name="rsvpAttending"]:checked');
                const mainGuestAlreadyRsvped = this.pendingGuest?.hasRsvped;

                // If main guest hasn't RSVPed, require their response
                if (!mainGuestAlreadyRsvped && !selectedAttending) {
                    this.showToast('Please select whether you will attend', 'error');
                    return;
                }

                // Collect family RSVPs with emails
                const familyRsvps = [];
                document.querySelectorAll('.family-rsvp-select').forEach(select => {
                    if (select.value) {
                        const memberId = select.dataset.memberId;
                        const emailInput = document.querySelector(`.family-email-input[data-member-id="${memberId}"]`);
                        familyRsvps.push({
                            guestId: memberId,
                            attending: select.value,
                            email: emailInput?.value || ''
                        });
                    }
                });

                // If main guest already RSVPed, require at least one family RSVP
                if (mainGuestAlreadyRsvped && familyRsvps.length === 0) {
                    this.showToast('Please select an RSVP option for at least one family member', 'error');
                    return;
                }

                try {
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                    submitBtn.disabled = true;

                    const attending = mainGuestAlreadyRsvped ? this.pendingGuest.rsvpResponse : selectedAttending.value;
                    const email = document.getElementById('rsvpEmail')?.value || '';
                    const dietary = document.getElementById('rsvpDietary')?.value || '';
                    const message = document.getElementById('rsvpMessage')?.value || '';

                    // If guestId is 0, we're in fallback mode - just proceed to registry
                    if (this.pendingGuest.id === 0) {
                        console.log(' Fallback mode - skipping RSVP save');
                        this.showToast('Welcome to our registry!', 'success');
                        await this.completeLogin();
                        return;
                    }

                    const response = await fetch('/api/guest-list/rsvp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            guestId: this.pendingGuest.id,
                            attending,
                            email: mainGuestAlreadyRsvped ? null : email, // Don't update email if already RSVPed
                            guestCount: 1,
                            dietary: mainGuestAlreadyRsvped ? null : dietary, // Don't update dietary if already RSVPed
                            message: mainGuestAlreadyRsvped ? null : message, // Don't update message if already RSVPed
                            familyRsvps,
                            skipMainGuestUpdate: mainGuestAlreadyRsvped // Flag to tell server not to update main guest
                        })
                    });

                    const result = await response.json();

                    if (response.ok && result.success) {
                        console.log(' RSVP submitted successfully');
                        this.lastRsvpResponse = attending; // Store for status display
                        const emailMsg = email ? ' Check your email for confirmation.' : '';
                        this.showToast('RSVP submitted!' + emailMsg + ' Welcome to our registry.', 'success');
                        await this.completeLogin();
                    } else {
                        throw new Error(result.error || 'Failed to submit RSVP');
                    }
                } catch (error) {
                    console.error(' RSVP error:', error);
                    // On error, still allow entry to registry
                    this.showToast('Welcome to our registry!', 'success');
                    await this.completeLogin();
                }
            }

            // Complete login and show main website
            async completeLogin() {
                // Set current guest from pending guest
                this.currentGuest = {
                    id: this.pendingGuest.id,
                    name: this.pendingGuest.name,
                    guestCode: 'GUESTLIST',
                    isGuestListAuth: true
                };

                // Store full guest info for status display
                window.currentGuestInfo = {
                    guest: {
                        ...this.pendingGuest,
                        hasRsvped: true,
                        rsvpResponse: this.lastRsvpResponse || this.pendingGuest.rsvpResponse
                    }
                };

                sessionStorage.setItem('weddingRegistryGuest', JSON.stringify(this.currentGuest));
                sessionStorage.setItem('weddingGuestInfo', JSON.stringify(window.currentGuestInfo));
                history.pushState({}, '', '/');

                console.log(` Guest logged in: ${this.currentGuest.name}`);
                await this.showMainWebsite();
            }

            // Navigate between auth steps
            goToStep(step) {
                this.authStep = step;
                this.updateStepIndicator(step);

                // Hide all step contents
                document.querySelectorAll('.auth-step-content').forEach(el => {
                    el.classList.remove('active');
                });

                // Show current step content
                const contentId = step === 1 ? 'step1Content' :
                                  step === 2 ? 'step2Content' : 'step3Content';
                const content = document.getElementById(contentId);
                if (content) content.classList.add('active');

                // Hide already RSVPed if going back
                if (step < 3) {
                    document.getElementById('alreadyRsvpedContent').style.display = 'none';
                }
            }

            // Update step indicator UI
            updateStepIndicator(currentStep) {
                document.querySelectorAll('.auth-step').forEach(stepEl => {
                    const stepNum = parseInt(stepEl.dataset.step);
                    stepEl.classList.remove('active', 'completed');

                    if (stepNum === currentStep) {
                        stepEl.classList.add('active');
                    } else if (stepNum < currentStep) {
                        stepEl.classList.add('completed');
                    }
                });
            }

            logout() {
                console.log(' Logging out...');
                sessionStorage.removeItem('weddingRegistryGuest');
                sessionStorage.removeItem('weddingGuestInfo');
                window.currentGuestInfo = null;
                this.currentGuest = null;
                this.pendingGuest = null;
                this.familyMembers = [];
                this.lastRsvpResponse = null;

                history.pushState({}, '', '/');

                this.showLoginScreen();

                // Reset auth flow to step 1
                this.goToStep(1);

                // Clear form inputs
                const guestCodeInput = document.getElementById('guestCode');
                if (guestCodeInput) guestCodeInput.value = '';
                const guestNameInput = document.getElementById('guestName');
                if (guestNameInput) guestNameInput.value = '';

                // Reset RSVP form
                document.querySelectorAll('input[name="rsvpAttending"]').forEach(r => r.checked = false);
                const dietaryInput = document.getElementById('rsvpDietary');
                if (dietaryInput) dietaryInput.value = '';
                const messageInput = document.getElementById('rsvpMessage');
                if (messageInput) messageInput.value = '';

                // Reset login button
                const loginBtn = document.getElementById('loginBtn');
                if (loginBtn) {
                    loginBtn.innerHTML = '<i class="fas fa-arrow-right"></i> Continue';
                    loginBtn.disabled = false;
                }

                // Reset find name button
                const findBtn = document.getElementById('findNameBtn');
                if (findBtn) {
                    findBtn.innerHTML = '<i class="fas fa-search"></i> Find My Name';
                    findBtn.disabled = false;
                }

                // Hide error messages
                const errorDiv = document.getElementById('nameLookupError');
                if (errorDiv) errorDiv.style.display = 'none';

                this.stopQRScanner();
            }

            async initializeStripe() {
                try {
                    console.log(' Initializing Stripe...');
                    const response = await fetch('/api/stripe-config');

                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                    }

                    const config = await response.json();

                    if (config.publishableKey) {
                        this.stripe = Stripe(config.publishableKey);
                        this.setupStripeElements();
                        console.log(' Stripe initialized successfully');
                    } else {
                        throw new Error('No publishable key found in config');
                    }
                } catch (error) {
                    console.error(' Failed to initialize Stripe:', error);
                    this.showToast('Payment system temporarily unavailable', 'error');
                }
            }

            setupStripeElements() {
                // Payment Element is now created dynamically in showPaymentModal
                // with the clientSecret from the payment intent
                console.log(' Stripe ready for Payment Element');
            }

            async createPaymentElement(clientSecret) {
                if (!this.stripe) return null;

                const appearance = {
                    theme: 'stripe',
                    variables: {
                        colorPrimary: '#1e3a5f',
                        colorBackground: '#ffffff',
                        colorText: '#1e3a5f',
                        colorDanger: '#ef4444',
                        fontFamily: 'system-ui, -apple-system, sans-serif',
                        borderRadius: '10px',
                    }
                };

                this.elements = this.stripe.elements({ clientSecret, appearance });
                this.paymentElement = this.elements.create('payment', {
                    layout: 'tabs',
                    wallets: {
                        applePay: 'auto',
                        googlePay: 'auto'
                    },
                    paymentMethodOrder: ['apple_pay', 'google_pay', 'card', 'link']
                });

                return this.paymentElement;
            }

            async loadItems() {
                try {
                    console.log(' Loading registry items...');
                    const response = await fetch('/api/items');
                    this.items = await response.json();
                    this.filteredItems = [...this.items];
                    this.renderItems();
                    this.updateFavoritesCount();
                    console.log(` Loaded ${this.items.length} registry items`);
                } catch (error) {
                    console.error(' Error loading items:', error);
                    this.showToast('Error loading registry items', 'error');
                }
            }

            renderItems() {
                const grid = document.getElementById('registryGrid');

                // Render special sections first
                this.renderFeaturedSection();
                this.renderAlmostFundedSection();

                if (this.filteredItems.length === 0) {
                    grid.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-search"></i>
                            <h3>No items found</h3>
                            <p>Try adjusting your search or filter criteria</p>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = '';
                this.filteredItems.forEach((item, index) => {
                    const itemElement = this.createItemElement(item, index);
                    grid.appendChild(itemElement);
                });
            }

            renderFeaturedSection() {
                // Get featured items: high priority OR top 3 by target amount (not fully funded)
                let featuredItems = this.items
                    .filter(item => {
                        if (!item.hasTarget) return false;
                        const percentage = (item.currentAmount / item.targetAmount) * 100;
                        return item.priority === 'high' && percentage < 100;
                    });

                // If no high priority items, show top 3 most expensive unfunded items
                if (featuredItems.length === 0) {
                    featuredItems = this.items
                        .filter(item => {
                            if (!item.hasTarget) return false;
                            const percentage = (item.currentAmount / item.targetAmount) * 100;
                            return percentage < 100;
                        })
                        .sort((a, b) => b.targetAmount - a.targetAmount);
                }

                featuredItems = featuredItems.slice(0, 3);

                // Remove existing section if present
                const existingSection = document.getElementById('featuredSection');
                if (existingSection) existingSection.remove();

                // Don't show if no featured items
                if (featuredItems.length === 0) return;

                const section = document.createElement('div');
                section.id = 'featuredSection';
                section.className = 'featured-section';
                section.innerHTML = `
                    <h3><i class="fas fa-star"></i> Our Top Picks</h3>
                    <p class="subtitle">Items we're most excited about for our new home together</p>
                    <div class="featured-carousel">
                        ${featuredItems.map(item => {
                            const percentage = Math.min((item.currentAmount / item.targetAmount) * 100, 100);
                            const imageUrl = item.imageUrl || item.image_url || '';
                            return `
                                <div class="featured-item">
                                    ${imageUrl ? `<img src="${imageUrl}" alt="${item.name}" class="featured-item-image" loading="lazy">` :
                                    `<div class="featured-item-image" style="background: var(--beige); display: flex; align-items: center; justify-content: center;"><i class="fas fa-gift" style="font-size: 3rem; color: var(--light-navy); opacity: 0.5;"></i></div>`}
                                    <div class="featured-item-content">
                                        <div class="featured-item-name">${item.name}</div>
                                        <div class="featured-item-progress">
                                            <div class="featured-item-progress-bar" style="width: ${percentage}%"></div>
                                        </div>
                                        <div class="featured-item-stats">
                                            <span>$${item.currentAmount.toFixed(0)} raised</span>
                                            <span>${percentage.toFixed(0)}%</span>
                                        </div>
                                        <a href="#" class="featured-item-link" onclick="document.querySelector('[data-item-id=\\'${item.id}\\']')?.scrollIntoView({behavior: 'smooth'}); return false;">
                                            <i class="fas fa-heart"></i> Contribute
                                        </a>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Insert at start of registry grid container
                const registryGrid = document.getElementById('registryGrid');
                if (registryGrid && registryGrid.parentNode) {
                    registryGrid.parentNode.insertBefore(section, registryGrid);
                }
            }

            renderAlmostFundedSection() {
                // Find items that are 70-99% funded
                const almostFundedItems = this.items.filter(item => {
                    if (!item.hasTarget || item.targetAmount === 0) return false;
                    const percentage = (item.currentAmount / item.targetAmount) * 100;
                    return percentage >= 70 && percentage < 100;
                });

                // Remove existing section if present
                const existingSection = document.getElementById('almostFundedSection');
                if (existingSection) existingSection.remove();

                // Don't show if no items qualify
                if (almostFundedItems.length === 0) return;

                // Create the section
                const section = document.createElement('div');
                section.id = 'almostFundedSection';
                section.className = 'almost-funded-section';
                section.innerHTML = `
                    <h3><i class="fas fa-fire"></i> Almost There!</h3>
                    <p class="subtitle">Help us complete these gifts - they're so close to being fully funded!</p>
                    <div class="almost-funded-grid">
                        ${almostFundedItems.map(item => {
                            const percentage = Math.min((item.currentAmount / item.targetAmount) * 100, 100);
                            const remaining = item.targetAmount - item.currentAmount;
                            return `
                                <div class="almost-funded-item">
                                    <div class="item-name">${item.name}</div>
                                    <div class="progress-container">
                                        <div class="progress-bar" style="width: ${percentage}%"></div>
                                    </div>
                                    <div class="progress-text">
                                        <span>$${item.currentAmount.toFixed(0)} of $${item.targetAmount.toFixed(0)}</span>
                                        <span>${percentage.toFixed(0)}%</span>
                                    </div>
                                    <a href="#item-${item.id}" class="contribute-link" onclick="document.querySelector('[data-item-id=\\'${item.id}\\']')?.scrollIntoView({behavior: 'smooth'}); return false;">
                                        <i class="fas fa-gift"></i> Only $${remaining.toFixed(0)} to go!
                                    </a>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;

                // Insert before registry grid
                const registryGrid = document.getElementById('registryGrid');
                if (registryGrid && registryGrid.parentNode) {
                    registryGrid.parentNode.insertBefore(section, registryGrid);
                }
            }

            createItemElement(item, index) {
                const itemDiv = document.createElement('div');
                const progressPercentage = item.hasTarget ? Math.min((item.currentAmount / item.targetAmount) * 100, 100) : 0;
                const isCompleted = item.hasTarget && item.currentAmount >= item.targetAmount;

                // Detect gift card items (5x $50 vouchers = $250 target)
                const isGiftCard = item.category === 'Gift Cards' || (item.name && item.name.toLowerCase().includes('gift card'));
                const voucherValue = 50; // Each voucher is $50
                const totalVouchers = isGiftCard ? Math.round(item.targetAmount / voucherValue) : 0;
                const vouchersPurchased = isGiftCard ? Math.floor(item.currentAmount / voucherValue) : 0;

                itemDiv.className = `registry-item ${isCompleted ? 'completed' : ''}`;
                itemDiv.dataset.itemId = item.id;

                const primaryImage = item.imageUrl || item.image_url;
                const secondaryImage = item.imageUrl2 || item.imageUrlFaded;
                const displayPrice = item.hasTarget ? `$${item.targetAmount.toFixed(0)}` : 'Any amount';

                // Check if item should show dual photos (Dyson V11 or items explicitly set)
                const showDualPhotos = item.name && item.name.toLowerCase().includes('dyson');

                // Show dual images for specific items, single for others
                let imageHtml;
                if (primaryImage && secondaryImage && showDualPhotos) {
                    // Dual image layout for Dyson
                    imageHtml = `
                        <div class="dual-image-container">
                            <img src="${primaryImage}" alt="${item.name}" loading="lazy" class="dual-img">
                            <img src="${secondaryImage}" alt="${item.name} - 2" loading="lazy" class="dual-img">
                        </div>
                    `;
                } else if (primaryImage) {
                    imageHtml = `<img src="${primaryImage}" alt="${item.name}" loading="lazy">`;
                } else {
                    imageHtml = `<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: var(--cream); color: var(--light-navy);"><i class="fas fa-gift" style="font-size: 3rem; opacity: 0.3;"></i></div>`;
                }

                let storeLinkBtn = '';
                if (item.storeLink && item.storeLink.trim()) {
                    try {
                        const url = new URL(item.storeLink);
                        const hostname = url.hostname.replace('www.', '');
                        storeLinkBtn = `
                            <a href="${item.storeLink}" target="_blank" rel="noopener noreferrer" class="store-link-btn">
                                <i class="fas fa-external-link-alt"></i> View on ${hostname}
                            </a>
                            <p style="font-size: 0.75rem; color: var(--light-navy); text-align: center; margin: 0.5rem 0 0.75rem; line-height: 1.4;">
                                <i class="fas fa-info-circle"></i> It doesn't have to be from this store, just ensure it is the exact product specified!
                            </p>
                        `;
                    } catch (e) {
                        storeLinkBtn = `
                            <a href="${item.storeLink}" target="_blank" rel="noopener noreferrer" class="store-link-btn">
                                <i class="fas fa-external-link-alt"></i> View in Store
                            </a>
                            <p style="font-size: 0.75rem; color: var(--light-navy); text-align: center; margin: 0.5rem 0 0.75rem; line-height: 1.4;">
                                <i class="fas fa-info-circle"></i> It doesn't have to be from this store, just ensure it is the exact product specified!
                            </p>
                        `;
                    }
                }

                // Single-sided card - all info on front
                itemDiv.innerHTML = `
                    <div class="card-single">
                        <div class="card-image">
                            ${imageHtml}
                            ${isCompleted ? `<div class="completed-badge"><i class="fas fa-check"></i> Complete</div>` : ''}
                        </div>
                        <div class="card-content">
                            <div class="card-header">
                                <div class="card-title">${item.name}</div>
                            </div>
                            <p class="card-description">${item.description}</p>

                            <div class="card-progress">
                                <div class="card-progress-bar">
                                    <div class="card-progress-fill" style="width: ${progressPercentage}%"></div>
                                </div>
                                <div class="card-progress-text">
                                    ${isGiftCard ? `
                                        <span>${vouchersPurchased}/${totalVouchers} vouchers</span>
                                        <span>$${item.currentAmount.toFixed(0)}/$${item.targetAmount.toFixed(0)}</span>
                                    ` : `
                                        <span>$${item.currentAmount.toFixed(0)} raised</span>
                                        <span>${progressPercentage.toFixed(0)}%</span>
                                    `}
                                </div>
                            </div>

                            ${storeLinkBtn}

                            ${!isCompleted ? `
                                <div class="card-actions">
                                    ${!item.hasTarget ? `
                                        <!-- Donation style (Honeymoon Fund) - just input field, no in-store button -->
                                        <div class="donation-input-row">
                                            <span class="donation-label">$</span>
                                            <input type="number" class="donation-amount-input" placeholder="Enter amount" min="1" step="1" data-item-id="${item.id}">
                                            <button class="donate-btn" data-item-id="${item.id}">
                                                <i class="fas fa-heart"></i> Contribute
                                            </button>
                                        </div>
                                    ` : isGiftCard ? `
                                        <div class="quick-amounts-mini gift-card-amounts">
                                            ${(totalVouchers - vouchersPurchased) >= 1 ? `
                                                <button class="quick-amount-mini voucher-btn" data-amount="50" data-item-id="${item.id}">
                                                    <i class="fas fa-gift"></i> 1 Voucher ($50)
                                                </button>
                                            ` : ''}
                                            ${(totalVouchers - vouchersPurchased) >= 2 ? `
                                                <button class="quick-amount-mini voucher-btn" data-amount="100" data-item-id="${item.id}">
                                                    <i class="fas fa-gift"></i> 2 Vouchers ($100)
                                                </button>
                                            ` : ''}
                                        </div>
                                        <p style="font-size: 0.75rem; color: var(--light-navy); text-align: center; margin: 0.25rem 0;">${totalVouchers - vouchersPurchased} of 5 vouchers remaining</p>
                                        <button class="bought-in-store-btn" data-item-id="${item.id}" onclick="registryApp.markAsBoughtInStore(${item.id});">
                                            <i class="fas fa-shopping-bag"></i> I bought this in store
                                        </button>
                                    ` : item.hasTarget && item.targetAmount <= 200 ? `
                                        <!-- Items $200 and under: in-store only, no online payment -->
                                        <button class="bought-in-store-btn" data-item-id="${item.id}" onclick="registryApp.markAsBoughtInStore(${item.id});">
                                            <i class="fas fa-shopping-bag"></i> I bought this in store
                                        </button>
                                    ` : `
                                        <!-- Items over $200: custom amount input -->
                                        <div class="donation-input-row">
                                            <span class="donation-label">$</span>
                                            <input type="number" class="donation-amount-input" placeholder="Amount" min="1" step="1" data-item-id="${item.id}">
                                            <button class="donate-btn" data-item-id="${item.id}">
                                                <i class="fas fa-heart"></i> Pay
                                            </button>
                                        </div>
                                        <button class="bought-in-store-btn" data-item-id="${item.id}" onclick="registryApp.markAsBoughtInStore(${item.id});">
                                            <i class="fas fa-shopping-bag"></i> I bought this in store
                                        </button>
                                    `}
                                </div>
                            ` : `
                                <div class="card-complete-section">
                                    <div class="complete-message">
                                        <i class="fas fa-check-circle"></i> Goal Reached!
                                    </div>
                                    <button class="undo-bought-btn" data-item-id="${item.id}" onclick="registryApp.undoBoughtInStore(${item.id});">
                                        <i class="fas fa-undo"></i> Undo
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                `;

                return itemDiv;
            }

            setupEventListeners() {
                console.log(' Setting up event listeners');

                // Favorite buttons
                document.addEventListener('click', (e) => {
                    const favBtn = e.target.closest('.favorite-btn');
                    if (favBtn) {
                        e.preventDefault();
                        e.stopPropagation();
                        const itemId = parseInt(favBtn.dataset.itemId);
                        this.toggleFavorite(itemId);
                    }
                });

                // Quick amount buttons (both regular and mini versions)
                // Use capture phase (true) to run before inline onclick stopPropagation
                document.addEventListener('click', async (e) => {
                    if (e.target.classList.contains('quick-amount') || e.target.classList.contains('quick-amount-mini')) {
                        const amount = e.target.dataset.amount;
                        const itemId = e.target.dataset.itemId;
                        const card = e.target.closest('.registry-item');

                        // For voucher buttons (gift cards), directly initiate payment
                        if (e.target.classList.contains('voucher-btn')) {
                            e.preventDefault();
                            console.log(' Voucher button clicked:', { itemId, amount });
                            await this.initiatePayment(itemId, parseFloat(amount));
                            return;
                        }

                        // For regular quick amount buttons, set the input value
                        const input = card ? card.querySelector(`input[data-item-id="${itemId}"]`) : document.querySelector(`input[data-item-id="${itemId}"]`);
                        if (input) {
                            input.value = amount;

                            // Remove selected from all quick amount buttons in this card
                            const buttons = card ? card.querySelectorAll('.quick-amount, .quick-amount-mini') : document.querySelectorAll(`[data-item-id="${itemId}"].quick-amount, [data-item-id="${itemId}"].quick-amount-mini`);
                            buttons.forEach(btn => btn.classList.remove('selected'));
                            e.target.classList.add('selected');
                        }
                    }
                }, true);

                // Contribute buttons (both regular and mini versions, and donate button)
                // Use capture phase (true) to run before inline onclick stopPropagation
                document.addEventListener('click', async (e) => {
                    const button = e.target.classList.contains('contribute-btn') || e.target.classList.contains('contribute-btn-mini') || e.target.classList.contains('donate-btn')
                        ? e.target
                        : e.target.closest('.contribute-btn, .contribute-btn-mini, .donate-btn');

                    if (button) {
                        e.preventDefault();
                        const itemId = button.dataset.itemId;
                        const card = button.closest('.registry-item');
                        // Check both regular input and donation input
                        const input = card ? (card.querySelector(`.donation-amount-input[data-item-id="${itemId}"]`) || card.querySelector(`input[data-item-id="${itemId}"]`)) : document.querySelector(`input[data-item-id="${itemId}"]`);
                        const amount = parseFloat(input?.value);

                        console.log(' Contribute clicked:', { itemId, amount, input: input?.value });

                        if (!amount || amount <= 0) {
                            this.showToast('Please enter a valid amount', 'error');
                            return;
                        }

                        await this.initiatePayment(itemId, amount);
                    }
                }, true);

                // Search functionality
                const searchInput = document.getElementById('searchInput');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.currentSearch = e.target.value.toLowerCase();
                        this.filterItems();
                    });
                }

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentFilter = e.target.dataset.filter;
                        this.filterItems();
                    });
                });

                // Payment form
                const paymentForm = document.getElementById('payment-form');
                if (paymentForm) {
                    paymentForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        await this.processStripePayment();
                    });
                }

                // Modal functionality
                const modal = document.getElementById('thankYouModal');
                const closeBtn = document.querySelector('.close');

                if (closeBtn) closeBtn.onclick = () => modal.style.display = 'none';

                window.onclick = (e) => {
                    if (e.target === modal) modal.style.display = 'none';
                    if (e.target.id === 'paymentModal') this.closePaymentModal();
                    if (e.target.id === 'boughtInStoreModal') this.closeBoughtInStoreModal();
                };
            }

            filterItems() {
                this.filteredItems = this.items.filter(item => {
                    const matchesSearch = !this.currentSearch ||
                        item.name.toLowerCase().includes(this.currentSearch) ||
                        item.description.toLowerCase().includes(this.currentSearch) ||
                        item.category.toLowerCase().includes(this.currentSearch);

                    let matchesFilter;
                    if (this.currentFilter === 'all') {
                        matchesFilter = true;
                    } else if (this.currentFilter === 'favorites') {
                        matchesFilter = this.favorites.includes(item.id);
                    } else if (this.currentFilter === 'completed') {
                        matchesFilter = item.hasTarget && item.currentAmount >= item.targetAmount;
                    } else {
                        matchesFilter = item.category === this.currentFilter;
                    }

                    return matchesSearch && matchesFilter;
                });

                // Sort items: Honeymoon fund first, then gift cards, then by price (cheapest to most expensive)
                this.filteredItems.sort((a, b) => {
                    // Check if items are honeymoon fund (donation style)
                    const aIsHoneymoon = a.name && a.name.toLowerCase().includes('honeymoon');
                    const bIsHoneymoon = b.name && b.name.toLowerCase().includes('honeymoon');

                    // Check if items are gift cards
                    const aIsGiftCard = (a.name && a.name.toLowerCase().includes('gift card')) || a.category === 'Gift Cards';
                    const bIsGiftCard = (b.name && b.name.toLowerCase().includes('gift card')) || b.category === 'Gift Cards';

                    // Honeymoon fund comes first
                    if (aIsHoneymoon && !bIsHoneymoon) return -1;
                    if (!aIsHoneymoon && bIsHoneymoon) return 1;

                    // Gift cards come second
                    if (aIsGiftCard && !bIsGiftCard) return -1;
                    if (!aIsGiftCard && bIsGiftCard) return 1;

                    // Then sort by completion status (completed items go to the bottom)
                    const aCompleted = a.hasTarget && a.currentAmount >= a.targetAmount;
                    const bCompleted = b.hasTarget && b.currentAmount >= b.targetAmount;
                    if (aCompleted && !bCompleted) return 1;  // a goes after b
                    if (!aCompleted && bCompleted) return -1; // a goes before b

                    // For incomplete items, sort by price (cheapest to most expensive)
                    if (!aCompleted && !bCompleted) {
                        const aPrice = a.hasTarget ? a.targetAmount : 0;
                        const bPrice = b.hasTarget ? b.targetAmount : 0;
                        return aPrice - bPrice; // ascending order (cheapest first)
                    }

                    return 0; // keep original order for completed items
                });

                this.renderItems();
            }

            async updateStats() {
                try {
                    const response = await fetch('/api/statistics');
                    const stats = await response.json();

                    const statsGrid = document.getElementById('statsGrid');
                    if (statsGrid) {
                        statsGrid.innerHTML = `
                            <div class="stat-card">
                                <div class="stat-number">$${stats.totalRaised.toFixed(0)}</div>
                                <div class="stat-label">Total Raised</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${stats.totalContributions}</div>
                                <div class="stat-label">Contributions</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${stats.completedItems}</div>
                                <div class="stat-label">Items Complete</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-number">${stats.progressPercentage.toFixed(0)}%</div>
                                <div class="stat-label">Overall Progress</div>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.error('Error loading stats:', error);
                }
            }

            async initiatePayment(itemId, amount) {
                if (!this.currentGuest) {
                    this.showToast('Please log in to make a contribution', 'error');
                    return;
                }

                const item = this.items.find(i => i.id == itemId);
                if (!item) {
                    this.showToast('Item not found', 'error');
                    return;
                }

                if (item.hasTarget && (item.currentAmount + amount) > item.targetAmount) {
                    const remaining = item.targetAmount - item.currentAmount;
                    if (remaining <= 0) {
                        this.showToast('This item has already reached its goal!', 'error');
                        return;
                    }

                    const proceed = confirm(`This contribution would exceed the goal by $${(amount - remaining).toFixed(2)}. Would you like to contribute exactly $${remaining.toFixed(2)} instead?`);
                    if (proceed) {
                        amount = remaining;
                    } else {
                        return;
                    }
                }

                this.currentPaymentData = { itemId, amount, item };
                this.showPaymentModal(amount, item.name);
            }

            async markAsBoughtInStore(itemId) {
                const item = this.items.find(i => i.id == itemId);
                if (!item) {
                    this.showToast('Item not found', 'error');
                    return;
                }

                // Show confirmation modal
                this.showBoughtInStoreModal(item);
            }

            showBoughtInStoreModal(item) {
                const modal = document.getElementById('boughtInStoreModal');
                const itemNameEl = document.getElementById('boughtInStoreItemName');
                const priceEl = document.getElementById('boughtInStorePrice');
                const confirmBtn = document.getElementById('confirmBoughtInStore');
                const voucherSection = document.getElementById('giftCardVoucherSection');
                const selectedAmountEl = document.getElementById('selectedVoucherAmount');

                itemNameEl.textContent = item.name;

                // Check if it's a gift card
                const isGiftCard = item.category === 'Gift Cards' || (item.name && item.name.toLowerCase().includes('gift card'));

                if (isGiftCard) {
                    // Calculate remaining vouchers
                    const voucherValue = 50;
                    const totalVouchers = 5;
                    const vouchersPurchased = Math.floor((item.currentAmount || 0) / voucherValue);
                    const vouchersRemaining = totalVouchers - vouchersPurchased;

                    // Show voucher selection for gift cards
                    priceEl.textContent = `${vouchersRemaining} of 5 vouchers remaining`;
                    voucherSection.style.display = 'block';
                    this.selectedVoucherAmount = 0;
                    selectedAmountEl.textContent = '';
                    confirmBtn.disabled = true;
                    confirmBtn.style.opacity = '0.5';

                    // Set up voucher button clicks - only show options that don't exceed remaining
                    const voucherBtns = voucherSection.querySelectorAll('.voucher-select-btn');
                    voucherBtns.forEach(btn => {
                        const voucherCount = parseInt(btn.dataset.vouchers);
                        if (voucherCount > vouchersRemaining) {
                            btn.style.display = 'none';
                        } else {
                            btn.style.display = 'block';
                            btn.style.background = 'white';
                            btn.style.color = 'var(--navy)';
                            btn.onclick = () => {
                                // Deselect all
                                voucherBtns.forEach(b => {
                                    b.style.background = 'white';
                                    b.style.color = 'var(--navy)';
                                });
                                // Select this one
                                btn.style.background = 'var(--gold)';
                                btn.style.color = 'white';
                                this.selectedVoucherAmount = voucherCount * 50;
                                selectedAmountEl.textContent = `Total: $${this.selectedVoucherAmount}`;
                                confirmBtn.disabled = false;
                                confirmBtn.style.opacity = '1';
                            };
                        }
                    });
                } else {
                    // Regular item
                    priceEl.textContent = item.hasTarget ? `$${item.targetAmount.toFixed(0)}` : 'Gift';
                    voucherSection.style.display = 'none';
                    this.selectedVoucherAmount = null;
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                }

                // Store item ID for confirmation
                this.pendingBoughtInStoreItemId = item.id;
                this.pendingBoughtInStoreItem = item;

                // Set up confirm button
                confirmBtn.onclick = () => this.confirmBoughtInStore();

                modal.style.display = 'block';
            }

            closeBoughtInStoreModal() {
                const modal = document.getElementById('boughtInStoreModal');
                modal.style.display = 'none';
                this.pendingBoughtInStoreItemId = null;
                this.pendingBoughtInStoreItem = null;
                this.selectedVoucherAmount = null;
            }

            async confirmBoughtInStore() {
                const itemId = this.pendingBoughtInStoreItemId;
                if (!itemId) return;

                const item = this.items.find(i => i.id == itemId);
                if (!item) return;

                // Check if it's a gift card with selected voucher amount
                const isGiftCard = item.category === 'Gift Cards' || (item.name && item.name.toLowerCase().includes('gift card'));
                const contributionAmount = isGiftCard && this.selectedVoucherAmount ? this.selectedVoucherAmount : (item.hasTarget ? item.targetAmount : 0);

                // For gift cards, only mark complete if buying all remaining or item will be complete
                const newTotal = item.currentAmount + contributionAmount;
                const markComplete = isGiftCard ? (newTotal >= item.targetAmount) : true;

                const confirmBtn = document.getElementById('confirmBoughtInStore');
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

                try {
                    const response = await fetch(`/api/items/${itemId}/bought-in-store`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            guestCode: this.currentGuest?.guestCode || 'anonymous',
                            guestName: this.currentGuest?.name || 'Anonymous',
                            amount: contributionAmount,
                            markComplete: markComplete
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.closeBoughtInStoreModal();
                        const voucherCount = isGiftCard ? Math.round(contributionAmount / 50) : 0;
                        const message = isGiftCard
                            ? `Thank you! ${voucherCount} voucher${voucherCount > 1 ? 's' : ''} ($${contributionAmount}) added to "${item.name}".`
                            : `Thank you! "${item.name}" marked as purchased in store.`;
                        this.showToast(message, 'success');

                        // Update local data
                        const localItem = this.items.find(i => i.id == itemId);
                        if (localItem) {
                            localItem.currentAmount = (localItem.currentAmount || 0) + contributionAmount;
                            localItem.contributorsCount = (localItem.contributorsCount || 0) + 1;
                        }

                        // Re-render items
                        this.filterItems();

                        // Flip card back
                        const card = document.querySelector(`[data-item-id="${itemId}"]`);
                        if (card) card.classList.remove('flipped');
                    } else {
                        throw new Error(result.error || 'Failed to mark as bought');
                    }
                } catch (error) {
                    console.error('Error marking item as bought in store:', error);
                    this.showToast('Failed to mark as bought in store. Please try again.', 'error');
                } finally {
                    // Reset button state
                    const confirmBtn = document.getElementById('confirmBoughtInStore');
                    if (confirmBtn) {
                        confirmBtn.disabled = false;
                        confirmBtn.innerHTML = '<i class="fas fa-check"></i> Yes, I bought this';
                    }
                }
            }

            async undoBoughtInStore(itemId) {
                const item = this.items.find(i => i.id == itemId);
                if (!item) {
                    this.showToast('Item not found', 'error');
                    return;
                }

                const confirmed = confirm(`Undo YOUR store purchase for "${item.name}"?\n\nThis will only remove your contribution, not others.`);

                if (!confirmed) return;

                try {
                    const response = await fetch(`/api/items/${itemId}/undo-bought-in-store`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            guestCode: this.currentGuest?.guestCode || 'anonymous',
                            guestName: this.currentGuest?.name || 'Anonymous'
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        this.showToast(`"${item.name}" store purchase has been undone.`, 'success');

                        // Update local data
                        const localItem = this.items.find(i => i.id == itemId);
                        if (localItem) {
                            localItem.currentAmount = result.item.currentAmount;
                            localItem.contributorsCount = Math.max(0, (localItem.contributorsCount || 1) - 1);
                        }

                        // Re-render items
                        this.filterItems();

                        // Flip card back
                        const card = document.querySelector(`[data-item-id="${itemId}"]`);
                        if (card) card.classList.remove('flipped');
                    } else {
                        throw new Error(result.error || 'Failed to undo');
                    }
                } catch (error) {
                    console.error('Error undoing store purchase:', error);
                    this.showToast('Failed to undo store purchase. Please try again.', 'error');
                }
            }

            async showPaymentModal(amount, itemName) {
                const modal = document.getElementById('paymentModal');
                const amountDisplay = document.getElementById('paymentAmount');
                const paymentElementContainer = document.getElementById('payment-element');
                const submitBtn = document.querySelector('#payment-form button[type="submit"]');

                if (amountDisplay) {
                    amountDisplay.textContent = `Contributing $${amount.toFixed(2)} to ${itemName}`;
                }

                // Reset submit button state
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-heart"></i> Pay Now';
                }

                // Show modal with loading state
                modal.style.display = 'block';
                paymentElementContainer.innerHTML = '<div class="payment-loading"><i class="fas fa-spinner fa-spin"></i> Preparing payment...</div>';

                try {
                    // Create payment intent
                    const response = await fetch('/api/create-payment-intent', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            amount: amount,
                            itemId: this.currentPaymentData.itemId,
                            itemName: itemName,
                            guestId: this.currentGuest?.id || 'anonymous',
                            currency: 'nzd'
                        })
                    });

                    const data = await response.json();
                    if (!response.ok) throw new Error(data.error || 'Failed to create payment');

                    this.currentPaymentData.clientSecret = data.clientSecret;
                    this.currentPaymentData.paymentIntentId = data.paymentIntentId;

                    // Create and mount Payment Element
                    paymentElementContainer.innerHTML = '';
                    const paymentElement = await this.createPaymentElement(data.clientSecret);
                    if (paymentElement) {
                        paymentElement.mount('#payment-element');
                        if (submitBtn) submitBtn.disabled = false;
                    }
                } catch (error) {
                    console.error('Payment setup error:', error);
                    paymentElementContainer.innerHTML = `<div class="payment-error"><i class="fas fa-exclamation-circle"></i> ${error.message}</div>`;
                    this.showToast('Failed to setup payment: ' + error.message, 'error');
                }
            }

            closePaymentModal() {
                const modal = document.getElementById('paymentModal');
                modal.style.display = 'none';

                // Clean up Payment Element
                if (this.paymentElement) {
                    this.paymentElement.unmount();
                    this.paymentElement = null;
                }
                this.elements = null;
                this.currentPaymentData = {};

                // Clear any error messages
                const errorDisplay = document.getElementById('payment-errors');
                if (errorDisplay) errorDisplay.textContent = '';
            }

            async processStripePayment() {
                console.log(' Processing Stripe payment...');

                if (!this.stripe || !this.elements || !this.currentPaymentData.clientSecret) {
                    this.showToast('Payment not properly initialized', 'error');
                    return;
                }

                const submitBtn = document.querySelector('#payment-form button[type="submit"]');
                const errorDisplay = document.getElementById('payment-errors');

                // Disable button and show loading
                if (submitBtn) {
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                }
                if (errorDisplay) errorDisplay.textContent = '';

                try {
                    // Confirm the payment
                    const { error, paymentIntent } = await this.stripe.confirmPayment({
                        elements: this.elements,
                        confirmParams: {
                            return_url: window.location.origin + '/payment-success',
                        },
                        redirect: 'if_required'
                    });

                    if (error) {
                        // Payment failed
                        console.error('Payment error:', error);
                        if (errorDisplay) errorDisplay.textContent = error.message;
                        this.showToast(error.message, 'error');
                        if (submitBtn) {
                            submitBtn.disabled = false;
                            submitBtn.innerHTML = '<i class="fas fa-lock"></i> Pay Now';
                        }
                        return;
                    }

                    console.log(' Payment result:', { paymentIntent, status: paymentIntent?.status });

                    if (paymentIntent && paymentIntent.status === 'succeeded') {
                        // Payment successful - record the contribution
                        // Use the stored paymentIntentId as fallback
                        const piId = paymentIntent.id || this.currentPaymentData.paymentIntentId;
                        console.log(' Recording contribution with PI:', piId);
                        await this.recordContribution(piId);
                    } else if (paymentIntent && paymentIntent.status === 'requires_action') {
                        // 3D Secure or other authentication required
                        this.showToast('Additional authentication required. Please complete the verification.', 'info');
                    } else {
                        console.log(' Unexpected payment status:', paymentIntent?.status);
                        this.showToast('Payment status: ' + (paymentIntent?.status || 'unknown'), 'warning');
                    }
                } catch (err) {
                    console.error('Payment processing error:', err);
                    this.showToast('Payment failed: ' + err.message, 'error');
                    if (submitBtn) {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-lock"></i> Pay Now';
                    }
                }
            }

            async recordContribution(paymentIntentId) {
                const { itemId, amount, item } = this.currentPaymentData;

                try {
                    const response = await fetch('/api/contributions', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            itemId: itemId,
                            guestId: this.currentGuest?.id,
                            guestName: this.currentGuest?.name || 'Anonymous',
                            amount: amount,
                            paymentIntentId: paymentIntentId,
                            message: ''
                        })
                    });

                    if (response.ok) {
                        this.closePaymentModal();
                        this.showToast(`Thank you for your $${amount.toFixed(2)} contribution to ${item.name}!`, 'success');
                        this.celebrateContribution();

                        // Update local data
                        const localItem = this.items.find(i => i.id == itemId);
                        if (localItem) {
                            localItem.currentAmount = (localItem.currentAmount || 0) + amount;
                            if (localItem.hasTarget && localItem.currentAmount >= localItem.targetAmount) {
                                this.celebrateFullyFunded(localItem.name);
                            }
                        }

                        // Refresh items from server
                        await this.loadItems();
                        this.filterItems();

                        // Flip card back
                        const card = document.querySelector(`[data-item-id="${itemId}"]`);
                        if (card) card.classList.remove('flipped');
                    } else {
                        throw new Error('Failed to record contribution');
                    }
                } catch (error) {
                    console.error('Error recording contribution:', error);
                    this.showToast('Payment received but failed to record. Please contact us.', 'warning');
                }
            }

            celebrateContribution() {
                // Small celebration for any contribution
                if (typeof confetti !== 'undefined') {
                    confetti({
                        particleCount: 50,
                        spread: 60,
                        origin: { y: 0.7 }
                    });
                }
                if ('vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100]);
                }
            }

            // Announce message to screen readers
            announceToScreenReader(message) {
                const liveRegion = document.getElementById('aria-live-region');
                if (liveRegion) {
                    liveRegion.textContent = message;
                    // Clear after announcement to allow repeat announcements
                    setTimeout(() => { liveRegion.textContent = ''; }, 1000);
                }
            }

            showToast(message, type = 'success', duration = 4000) {
                // Remove existing toast if any
                const existingToast = document.querySelector('.toast');
                if (existingToast) existingToast.remove();

                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    info: 'fa-info-circle',
                    warning: 'fa-exclamation-triangle'
                };

                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.innerHTML = `<i class="fas ${icons[type] || icons.info}"></i> ${message}`;
                toast.setAttribute('role', 'alert');
                toast.setAttribute('aria-live', 'assertive');
                document.body.appendChild(toast);

                // Also announce to screen readers
                this.announceToScreenReader(message);

                // Trigger animation
                setTimeout(() => toast.classList.add('show'), 50);

                // Auto dismiss
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) toast.remove();
                    }, 300);
                }, duration);

                // Haptic feedback on mobile
                if ('vibrate' in navigator) {
                    navigator.vibrate(50);
                }
            }

            // Celebration for 100% funded items
            celebrateFullyFunded(itemName) {
                // Fire confetti
                if (typeof confetti !== 'undefined') {
                    // Left side burst
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { x: 0.1, y: 0.6 },
                        colors: ['#1e3a5f', '#d4af37', '#ffffff', '#4a7c9e']
                    });
                    // Right side burst
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { x: 0.9, y: 0.6 },
                        colors: ['#1e3a5f', '#d4af37', '#ffffff', '#4a7c9e']
                    });
                    // Center burst after delay
                    setTimeout(() => {
                        confetti({
                            particleCount: 150,
                            spread: 100,
                            origin: { x: 0.5, y: 0.5 },
                            colors: ['#1e3a5f', '#d4af37', '#ffffff', '#4a7c9e']
                        });
                    }, 300);
                }

                // Show celebration overlay
                const overlay = document.createElement('div');
                overlay.className = 'celebration-overlay';
                overlay.innerHTML = `
                    <div class="celebration-content">
                        <h2>Amazing!</h2>
                        <p>Thanks to wonderful people like you...</p>
                        <div class="item-name">${itemName}</div>
                        <p>is now fully funded! </p>
                        <p style="font-size: 1rem; opacity: 0.9;">Sam & Beatrice are so grateful for your generosity!</p>
                        <button class="celebration-close" onclick="this.closest('.celebration-overlay').remove()">
                            <i class="fas fa-heart"></i> Continue Browsing
                        </button>
                    </div>
                `;
                document.body.appendChild(overlay);

                // Haptic feedback
                if ('vibrate' in navigator) {
                    navigator.vibrate([100, 50, 100, 50, 200]);
                }

                // Auto-close after 8 seconds
                setTimeout(() => {
                    if (overlay.parentNode) {
                        overlay.style.opacity = '0';
                        setTimeout(() => overlay.remove(), 500);
                    }
                }, 8000);
            }

            // Initialize lazy loading for images
            initLazyLoading() {
                if ('IntersectionObserver' in window) {
                    const imageObserver = new IntersectionObserver((entries, observer) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                if (img.dataset.src) {
                                    img.src = img.dataset.src;
                                    img.removeAttribute('data-src');
                                }
                                img.classList.add('loaded');
                                observer.unobserve(img);
                            }
                        });
                    }, {
                        rootMargin: '50px 0px',
                        threshold: 0.01
                    });

                    document.querySelectorAll('img.lazy-image').forEach(img => {
                        imageObserver.observe(img);
                    });
                } else {
                    // Fallback for older browsers
                    document.querySelectorAll('img.lazy-image').forEach(img => {
                        if (img.dataset.src) {
                            img.src = img.dataset.src;
                        }
                        img.classList.add('loaded');
                    });
                }
            }
        }

        // Global function for closing payment modal
        function closePaymentModal() {
            if (registryApp) {
                registryApp.closePaymentModal();
            }
        }

        // Check gallery access based on wedding date
        function checkGalleryAccess() {
            const weddingDate = new Date('2026-03-14T23:59:59'); // March 14, 2026 at end of day
            const now = new Date();
            const galleryContent = document.getElementById('galleryContent');
            const galleryLockedMessage = document.getElementById('galleryLockedMessage');

            if (now >= weddingDate) {
                // After wedding - show gallery
                if (galleryContent) galleryContent.style.display = 'block';
                if (galleryLockedMessage) galleryLockedMessage.style.display = 'none';
            } else {
                // Before wedding - show locked message
                if (galleryContent) galleryContent.style.display = 'none';
                if (galleryLockedMessage) galleryLockedMessage.style.display = 'block';
            }
        }

        // Initialize the website when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log(' DOM loaded, initializing wedding website...');
            checkGalleryAccess();
            registryApp = new WeddingWebsite();
        });

        // Also initialize if DOM is already loaded
        if (document.readyState === 'loading') {
            // DOM is still loading, wait for DOMContentLoaded
        } else {
            // DOM is already loaded
            console.log(' DOM already loaded, initializing wedding website...');
            checkGalleryAccess();
            registryApp = new WeddingWebsite();
        }

        // FAQ Toggle Function
        function toggleFAQ(element) {
            const faqItem = element.closest('.faq-item');
            const isActive = faqItem.classList.contains('active');

            // Close all FAQ items
            document.querySelectorAll('.faq-item').forEach(item => {
                item.classList.remove('active');
            });

            // Open clicked item if it wasn't already open
            if (!isActive) {
                faqItem.classList.add('active');
            }
        }

        // Scroll-triggered animations
        function initScrollAnimations() {
            const animatedElements = document.querySelectorAll('.animate-on-scroll, .stagger-children');

            if (animatedElements.length === 0) return;

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.15,
                rootMargin: '-40px'
            });

            animatedElements.forEach(el => observer.observe(el));
        }

        // Scroll progress indicator
        function initScrollProgress() {
            const progressBar = document.querySelector('.nav-progress');
            if (!progressBar) return;

            window.addEventListener('scroll', () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const progress = (scrollTop / docHeight) * 100;
                progressBar.style.width = progress + '%';
            }, { passive: true });
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', () => {
            initScrollAnimations();
            initScrollProgress();
        });
    </script>

    <!-- Service Worker Registration for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log(' Service Worker registered:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available
                                    console.log(' New content available, refresh to update');
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error(' Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
